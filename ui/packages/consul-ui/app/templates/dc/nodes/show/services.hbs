{{!
  Copyright (c) HashiCorp, Inc.
  SPDX-License-Identifier: BUSL-1.1
}}

<Route
  @name={{this.routeName}}
as |route|>
  {{#let

    (hash
      value=(or this.sortBy "Status:asc")
      change=(action (mut this.sortBy) value="target.selected")
    )

    (hash
      status=(hash
        value=(if this.status (split this.status ',') undefined)
        change=(action (mut this.status) value="target.selectedItems")
      )
      source=(hash
        value=(if this.source (split this.source ',') undefined)
        change=(action (mut this.source) value="target.selectedItems")
      )
      searchproperty=(hash
        value=(if (not-eq this.searchproperty undefined)
          (split this.searchproperty ',')
          this.searchProperties
        )
        change=(action (mut this.searchproperty) value="target.selectedItems")
        default=this.searchProperties
      )
    )

    route.model.item.MeshServiceInstances
    route.model.item.ProxyServiceInstances

  as |sort filters items proxies|}}
  <div class="tab-section">
    {{#if (gt items.length 0) }}
      <input type="checkbox" id="toolbar-toggle" />
      <Consul::ServiceInstance::SearchBar
        @sources={{get (collection items) 'ExternalSources'}}
        @search={{this.search}}
        @onsearch={{action (mut this.search) value="target.value"}}
        @searchproperties={{this.searchProperties}}

        @sort={{sort}}

        @filter={{filters}}
        />
      {{/if}}
      <DataCollection
        @type="service-instance"
        @sort={{sort.value}}
        @filters={{filters}}
        @search={{this.search}}
        @items={{items}}
      as |collection|>
        <collection.Collection>
          <Consul::ServiceInstance::List
            @node={{route.model.item}}
            @routeName="dc.services.show"
            @items={{collection.items}}
            @proxies={{proxies}}
          />
        </collection.Collection>
        <collection.Empty>
          <EmptyState>
            <BlockSlot @name="body">
              {{t "routes.dc.nodes.show.services.empty"
                items=items.length
                htmlSafe=true
              }}
            </BlockSlot>
          </EmptyState>
        </collection.Empty>
      </DataCollection>
  </div>
  {{/let}}
</Route>