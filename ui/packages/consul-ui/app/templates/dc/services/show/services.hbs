{{!
  Copyright (c) HashiCorp, Inc.
  SPDX-License-Identifier: BUSL-1.1
}}

<Route
  @name={{this.routeName}}
as |route|>
  <DataLoader @src={{
      uri '/${partition}/${nspace}/${dc}/gateways/for-service/${name}'
      (hash
        partition=route.params.partition
        nspace=route.params.nspace
        dc=route.params.dc
        name=route.params.name
      )
  }} as |loader|>

    <BlockSlot @name="error">
      <AppError
        @error={{loader.error}}
        @login={{route.model.app.login.open}}
      />
    </BlockSlot>

    <BlockSlot @name="loaded">
  <div class="tab-section">
  {{#let

    (hash
      value=(or this.sortBy "Status:asc")
      change=(action (mut this.sortBy) value="target.selected")
    )

    (hash
      instance=(hash
        value=(if this.instance (split this.instance ',') undefined)
        change=(action (mut this.instance) value="target.selectedItems")
      )
      searchproperty=(hash
        value=(if (not-eq this.searchproperty undefined)
          (split this.searchproperty ',')
          this.searchProperties
        )
        change=(action (mut this.searchproperty) value="target.selectedItems")
        default=this.searchProperties
      )
    )

    loader.data

  as |sort filters items|}}
  {{#if (gt items.length 0)}}
      <input type="checkbox" id="toolbar-toggle" />
      <Consul::Upstream::SearchBar
        @search={{this.search}}
        @onsearch={{action (mut this.search) value="target.value"}}

        @sort={{sort}}

        @filter={{filters}}
        />
  {{/if}}
      <DataCollection
        @type="service"
        @sort={{sort.value}}
        @filters={{filters}}
        @search={{this.search}}
        @items={{items}}
      as |collection|>
        <collection.Collection>
          {{t "routes.dc.services.show.services.intro"
            htmlSafe=true
          }}
          <Consul::Service::List
            @nspace={{or route.params.nspace route.model.user.token.Namespace 'default'}}
            @partition={{or route.params.partition route.model.user.token.Partition 'default'}}
            @items={{collection.items}}
          >
          </Consul::Service::List>
        </collection.Collection>
        <collection.Empty>
          <EmptyState>
            <BlockSlot @name="body">
              {{t "routes.dc.services.show.services.empty"
                items=items.length
                htmlSafe=true
              }}
            </BlockSlot>
          </EmptyState>
        </collection.Empty>
      </DataCollection>
  {{/let}}
  </div>
    </BlockSlot>
  </DataLoader>
</Route>
