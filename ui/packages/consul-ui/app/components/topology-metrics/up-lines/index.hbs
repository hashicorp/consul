{{on-window 'resize' (action this.getIconPositions)}}

{{#if (gt @lines.length 0)}}
  <svg
    {{did-insert this.getIconPositions}}
    {{did-update this.getIconPositions @lines}}
    viewBox={{concat @center.x ' ' @view.y ' ' @view.width ' ' @view.height}}
    preserveAspectRatio="none"
  >
    <defs>
      <marker id="allow-arrow" viewBox="-1 -1 12 12" refX="5" refY="5"
          markerWidth="6" markerHeight="6"
          orient="auto-start-reverse">
        <polygon points="0 0 10 5 0 10" />
      </marker>
      <marker id="deny-arrow" viewBox="-1 -1 12 12" refX="5" refY="5"
          markerWidth="6" markerHeight="6"
          orient="auto-start-reverse">
        <polygon points="0 0 10 5 0 10" />
      </marker>
    </defs>
{{#each @lines as |line|}}
  {{#if (eq line.permission 'deny')}}
    <path
      id={{line.id}}
      d={{svg-curve line.dest src=line.src}}
      marker-end="url(#deny-arrow)"
      data-permission={{line.permission}}
    />
  {{else}}
     <path
      id={{line.id}}
      d={{svg-curve line.dest src=line.src}}
      marker-end="url(#allow-arrow)"
      data-permission={{line.permission}}
    />
  {{/if}}
{{/each}}
  </svg>
{{/if}}

{{#each @items as |item|}}
  <TopologyMetrics::Button
    @positions={{this.iconPositions}}
    @item={{item}}
  />
{{/each}}
