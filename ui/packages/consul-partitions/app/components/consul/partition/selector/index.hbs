{{!
  Copyright (c) HashiCorp, Inc.
  SPDX-License-Identifier: BUSL-1.1
}}

{{#let
  @list
  (if @partition (hash Name=@partition) (hash Name="default"))
  (is-href "dc.partitions" @dc.Name)
  (can "choose partitions" dc=@dc)
  as |SNL partition isManaging canChoose|
}}
  <DataSource
    @src={{uri "/*/*/${dc}/partitions" (hash dc=@dc.Name)}}
    @onchange={{fn (optional @onchange)}}
  />
  <SNL.Title class="consul-side-nav__selector-title">Admin partition</SNL.Title>
  <NavSelector
    @list={{@list}}
    @items={{sort-by "Name:asc" (reject-by "DeletedAt" @partitions)}}
    @item={{partition}}
    @key="Name"
    @icon="users"
    @placeholder="Search partitions"
    @footerLink={{href-to "dc.partitions" @dc.Name}}
    @footerLinkText="View all partitions"
    @disabled={{not canChoose}}
    data-test-datacenter-disclosure-menu
    as |Dropdown item|
  >
    {{#if canChoose}}
      <Dropdown.Checkmark
        @selected={{eq partition.Name item.Name}}
        @href={{if
          item.href
          item.href
          (if
            isManaging
            (href-to
              "dc.services.index"
              params=(hash partition=item.Name nspace=undefined dc=@dc.Name)
            )
            (href-to "." params=(hash partition=item.Name nspace=undefined))
          )
        }}
        @isHrefExternal={{false}}
        data-test-partiton-item
      >
        {{item.Name}}
      </Dropdown.Checkmark>
    {{/if}}
  </NavSelector>
{{/let}}
{{!-- 
{{#let
  (or @partition "default")
  (is-href "dc.partitions" @dc.Name)
  as |partition isManaging|
}}
  {{#if (can "choose partitions" dc=@dc)}}
    <li class="partitions" data-test-partition-menu>
     <DisclosureMenu
        aria-label="Admin Partition"
        @items={{append
          (hash
            Name="Manage Partitions" href=(href-to "dc.partitions" @dc.Name)
          )
          (reject-by "DeletedAt" @partitions)
        }}
        as |disclosure|
      >
        <disclosure.Action {{on "click" disclosure.toggle}}>
          {{if isManaging "Manage Partition" partition}}
        </disclosure.Action>
        <disclosure.Menu as |panel|>
          <DataSource
            @src={{uri "/*/*/${dc}/partitions" (hash dc=@dc.Name)}}
            @onchange={{fn (optional @onchange)}}
          />
          <panel.Menu as |menu|>
            {{#each menu.items as |item|}}
              <menu.Item
                aria-current={{if
                  (or
                    (and isManaging item.href)
                    (and (not isManaging) (eq partition item.Name))
                  )
                  "true"
                }}
              >
                <menu.Action
                  {{on "click" disclosure.close}}
                  @href={{if
                    item.href
                    item.href
                    (if
                      isManaging
                      (href-to
                        "dc.services.index"
                        params=(hash
                          partition=item.Name nspace=undefined dc=@dc.Name
                        )
                      )
                      (href-to
                        "." params=(hash partition=item.Name nspace=undefined)
                      )
                    )
                  }}
                >
                  {{item.Name}}
                </menu.Action>
              </menu.Item>
            {{/each}}
          </panel.Menu>
        </disclosure.Menu>
      </DisclosureMenu>
    </li>
  {{else}}
    <li class="partition" aria-label="Admin Partition">
      {{"default"}}
    </li>
  {{/if}}
{{/let}} --}}