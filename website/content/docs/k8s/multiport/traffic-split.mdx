---
layout: docs
page_title: Split traffic between multi-port services 
description: Learn how to configure Consul to split TCP traffic between two ports of a multi-port service using the TCPRoute resource and the v2 catalog API
---

# Split TCP traffic between multi-port services

<Warning>

Multi-port services are part of a beta release. This documentation supports testing and development scenarios. Do not use multi-port services or the v2 catalog API in secure production environments.

</Warning>

This page describes the process for splitting TCP, HTTP, and gRPC traffic between two ports of a multi-port service. It includes an example TCPRoute resource configuration to demonstrate Consul's multi-port features.

## Prerequisites

Splitting traffic between two ports of a multi-port service requires the [v2 catalog API](/consul/docs/architecture/catalog/v2). For guidance on enabling the v2 catalog, deploying multi-port services, and applying traffic permissions to them, refer to [configure multi-port services](/consul/docs/k8s/multiport/configure).

## Overview

Complete the following steps to implement a split in TCP traffic between two services:

1. Define the resource's behavior in a custom resource definition (CRD).
1. Apply the resource to your cluster.
1. Output the resource path with the `consul resource read` command.

## Define route resource

The following example splits traffic for the `api` service. TCP traffic for services registered to the Consul catalog that are available at the `api-workload` port is split so that 50% of the traffic routes to the service at the `api-workload` port and 50% routes to the service at the `admin-workload` port.

<CodeBlockConfig filename="api-split.yaml">

```yaml
apiVersion: mesh.consul.hashicorp.com/v2beta1
kind: TCPRoute
metadata:
  name: api-split
  namespace: default
spec:
  parentRefs:
    - ref:
        type: 
          group: catalog
          groupVersion: v2beta1
          kind: Service
        name: api
      port: "api-workload"
  rules:
    - backendRefs:
      - backendRef:
          ref: 
            type:
              group: catalog
              groupVersion: v2beta1
              kind: Service
            name: api
          port: "api-workload"
        weight: 50
      - backendRef:
          ref: 
            type:
              group: catalog
              groupVersion: v2beta1
              kind: Service
            name: api
          port: "admin-workload"
        weight: 50
```

</CodeBlockConfig>

## Apply the resource

Use the `kubectl` command to apply the resource to your Consul cluster.

```shell-session
$ kubectl apply -f api-split.yaml
```

## Read the resource path

[Final TODO]