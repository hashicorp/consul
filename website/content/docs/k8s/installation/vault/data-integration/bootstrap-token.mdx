---
layout: docs
page_title: Storing ACL Bootstrap Token in Vault
description: >-
  Configuring the Consul Helm chart to use ACL bootstrap token stored in Vault.
---

# Storing the ACL Bootstrap Token in Vault

## Pre-requisites
Prior to setting up data integration between Vault and Consul on Kubernetes, you will need to have:  
1. Read and completed the steps in the [Systems Integration](/docs/k8s/installation/vault/systems-integration) section of [Vault as a Secrets Backend](/docs/k8s/installation/vault).
2. Read the [Data Integration Overview](/docs/k8s/installation/vault/systems-integration) section of [Vault as a Secrets Backend](/docs/k8s/installation/vault).

## Overview
To use an ACL bootstrap token stored in Vault, we will follow the steps outlined in the [Data Integration](/docs/k8s/installation/vault/data-integration):

- One time set up in Vault
  1. Store the secret in Vault.
  1. Create a Vault policy that authorizes the desired level of access to the secret.
- Set up per Consul data center
  1. Create a Vault Kubernetes auth roles that link the policy to each Consul on Kubernetes service account that requires access.
  1. Configure the Vault Kubernetes auth role in the Consul on Kubernetes helm chart..

## One time set up in Vault
### Store the Secret in Vault

First, store the ACL bootstrap token in Vault:

```shell-session
$ vault kv put secret/consul/boostrap-token token="<ACL bootstrap Token>"
```

Next, you will need to create a policy that allows read access to this secret:


<CodeBlockConfig filename="bootstrap-token-policy.hcl">

```HCL
path "secret/data/consul/boostrap-token" {
  capabilities = ["read"]
}
```

</CodeBlockConfig>

```shell-session
$ vault policy write boostrap-token-policy boostrap-token-policy.hcl
```

Prior to creating Vault auth roles for the Consul servers and clients, ensure that the Vault Kubernetes auth method is enabled as described in [Vault Kubernetes Auth Method](/docs/k8s/installation/vault#vault-kubernetes-auth-method).

Next, you will create Kubernetes auth roles for the Consul ACL manger, which is technically the `server-acl-init` container that runs as part of the Consul server statefulset:

```shell-session
$ vault write auth/kubernetes/role/consul-acl-manager \
    bound_service_account_names=<Consul server service account> \
    bound_service_account_namespaces=<Consul installation namespace> \
    policies=boostrap-token-policy \
    ttl=1h
```

To find out the service account names of the Consul server and client,
you can run the following `helm template` commands with your Consul on Kubernetes values file:

- Generate Consul server service account name
  ```shell-session
  $ helm template --release-name ${RELEASE_NAME} -s templates/server-serviceaccount.yaml hashicorp/consul
  ```

- Generate Consul client service account name
  ```shell-session
  $ helm template --release-name ${RELEASE_NAME} -s templates/client-serviceaccount.yaml hashicorp/consul
  ```

## Deploying the Consul Helm chart

Now that you have configured Vault, you can configure the Consul Helm chart to
use the enterprise license key in Vault:

<CodeBlockConfig filename="values.yaml">

```yaml
global:
  secretsBackend:
    vault:
      enabled: true
      manageSystemACLsRole: consul-acl-manager
  acls:
    bootstrapToken:
      secretName: secret/data/consul/bootstrap-token
      secretKey: token
```

</CodeBlockConfig>

Note that `global.acls.bootstrapToken.secretName` is the path of the secret in Vault.
This should be the same path as the one you included in your Vault policy.
`global.acls.bootstrapToken.secretKey` is the key inside the secret data. This should be the same
as the key you passed when creating the enterprise license secret in Vault.
