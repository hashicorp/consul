---
layout: docs
page_title: Backup and restore a Consul datacenter
description: >-
   Learn how to backup Consul data and state and restore a valid backup using the snapshot tool.
---

# Backup and restore a Consul datacenter

Backups provide a mechanism for a cluster to recover from an outage caused by any combination of network loss, operator error, or a corrupted data directory. We recommend testing the restore functionality at least once before your cluster is live in production.

We recommend you backup the Consul cluster before upgrading, in case the upgrade does not go according to plan and then downgrading becomes impossible due to changes in the state store format. In such a situation, restoring from a backup is the only option to restore functionality.

Consul provides the [snapshot](/consul/commands/snapshot) command which can be manually executed using the CLI or the API to save or restore a point-in-time snapshot which includes, but is not limited to:

- Key-Value entries
- the service catalog
- prepared queries
- sessions
- ACLs 

With Consul Enterprise, you can run a [snapshot agent daemon](/consul/commands/snapshot/agent) that periodically takes snapshots and writes to local or remote storage, including Amazon S3, Azure Blob Storage, and Google Cloud Storage.

By default, all snapshots are taken using `consistent` mode where requests are forwarded to the leader which verifies that it is still in power before taking the snapshot. Snapshots will not be saved if the Consul datacenter is degraded or if no leader is available. To reduce the burden on the leader, it is possible to [run the snapshot](/consul/commands/snapshot/save) on any non-leader server using `stale` consistency mode. We recommend you take `consistent` snapshots for write-heavy production use cases, or when you want to snapshot a cluster state after an immediate specific change. Otherwise, for scheduled backups or other non-critical procedures, we recommend taking snapshots using the `stale` consistency mode, which can spread the load across nodes at the possible expense of losing full consistency guarantees. Not having full consistency guarantees means that a very small number of recent writes may be omitted - writes that are typically limited to data written in the last `100ms` or less.

## Workflow

1. **Backup the Consul Datacenter**: Use the `snapshot save` command to create a backup of the Consul datacenter.
2. **Verify the Backup**: Inspect the backup file to ensure it was created successfully.
3. **Restore from Backup**: If needed, use the `snapshot restore` command to restore the Consul datacenter from the backup.

## Where to start

To backup and restore a Consul datacenter, you will use the snapshot functionality. The following sections describe how to backup and restore a Consul datacenter using the `snapshot` command.

### Backup a Consul datacenter

The `snapshot save` command for backing up the Consul cluster state has many configuration options. In a production environment, you will want to configure ACL tokens and client certificates for security. The configuration options also allow you to specify the Consul cluster and server to collect the backup data from. Below are several examples.

First, you will run the basic snapshot command on one of the servers using the default configuration, including `consistent` mode.

```shell-session
$ consul snapshot save backup.snap
Saved and verified snapshot to index 1176
```

The backup will be saved locally in the directory where you ran the command.

You can view metadata about the backup with the `inspect` subcommand.

```shell-session
$ consul snapshot inspect backup.snap
ID           2-1182-1542056499724
Size         4115
Index        1182
Term         2
Version      1
```

For more info on each field of the `snapshot inspect` command output, review the related [documentation](/consul/commands/snapshot/inspect).

The Consul cluster data is usually streamed from the leader server via the client you query. To avoid streaming the data directly from the leader server and obtain the local copy of the data in the Raft database, you can do so by specifying stale mode.

```shell-session
$ consul snapshot save -stale backup.snap
Saved and verified snapshot to index 2276
```

For production use, we recommend automatic saving of snapshots via the `snapshot agent` enterprise command, which runs a daemon that periodically takes snapshots and writes them to local or remote cloud storage. This is especially useful for large clusters where manual snapshotting can be cumbersome.

For Consul Community Edition, the `snapshot save` command or [API](/consul/api-docs/snapshot) can instead be scripted to run frequently.

### Restore a Consul datacenter

Restoring a Consul snapshot involves running the `snapshot restore` command. To succeed, you need the target cluster being stable and having a leader. If you suspect the opposite, you can verify the Raft members state using `consul operator raft list-peers` and checking server logs and telemetry for signs of leader elections or network issues.

When restoring a Consul cluster from a snapshot on new infrastructure, make sure node names are unique, otherwise you might encounter restore issues. For more information, refer to [Snapshot restore error](/consul/docs/error-messages/consul#snapshot-restore-error).

You only need to run the snapshot restore process once. If the target Consul server is not the cluster leader, the snapshot data contents will be streamed towards the leader. The Raft consensus protocol ensures that all servers restore the same state.

```shell-session
$ consul snapshot restore backup.snap
Restored snapshot
```

Just like the `snapshot save` command, you can specify access tokens and certificates via command parameters or environment variables.

## Additional guidance

For more information on disaster recovery, including detailed instructions on how to backup and restore Consul datacenters, refer to the following resources:

- [Consul Disaster Recovery](consul/docs/manage/disaster-recovery)
- [Disaster recovery for WAN-federated datacenters](/consul/docs/manage/disaster-recovery/federation)
