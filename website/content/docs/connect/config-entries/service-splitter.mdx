--- 
Page_title: Service Splitter | Configuration Reference
Description: 
---

# Service Splitter Configuration Reference

This topic describes how to configure service splitter configuration entries. Configure and apply service splitters to redirect a percentage of incoming traffic requests for a specific service.

## Configuration model

The following list outlines field hierarchy, language-specific data types, and requirements in a service splitter configuration entry. Click on a property name to view details about the configuration.

<Tabs>

<Tab heading="HCL" group="hcl">

- [`Kind`](#kind-kind): string | required
- [`Name`](#name-name): string | required
- [`Namespace`](#namespace-namespace): string | optional <EnterpriseAlert inline />
- [`Partition`](#partition-partition): string | optional <EnterpriseAlert inline />
- [`Meta`](#meta): map | optional
- [`Splits`](#splits-splits): map | required
	- [`Weight`](#weight-weight): number | required
	- [`Service`](#service-service): string | required
	- [`ServiceSubset`](#servicesubset-servicesubset): string | optional
  - [`Namespace`](#namespace-namespace): string | optional <EnterpriseAlert inline />
  - [`Partition`](#partition-partition): string | optional <EnterpriseAlert inline />
  - [`RequestHeaders`](#requestheaders-requestheaders): map | optional
    - [`Add`](#requestheaders-requestheaders): map | optional
    - [`Set`](#requestheaders-requestheaders): map | optional
    - [`Remove`](#requestheaders-requestheaders): map | optional
  - [`ResponseHeaders`](#responseheaders-responseheaders): map | optional
    - [`Add`](#responseheaders-responseheaders): map | optional
    - [`Set`](#responseheaders-responseheaders): map | optional
    - [`Remove`](#responseheaders-responseheaders): map | optional

</Tab>

<Tab heading="YAML" group="yaml">

- [`apiVersion`](#apiVersion): string | required
- [`kind`](#kind-kind): string | required
- [`metadata`](#metadata): object | required
	- [`name`](#name-name): string | required
	- [`namespace`](#namespace-namespace): string | optional <EnterpriseAlert inline />
- [`spec`](#spec): object | required
	- [`splits`](#splits-splits): array | required
		- [`weight`](#weight-weight): float32 | required
		- [`service`](#service-service): string | required
	  - [`serviceSubset`](#servicesubset-servicesubset): string | optional
    - [`namespace`](#namespace-namespace): string | optional <EnterpriseAlert inline />
    - [`partition`](#partition-partition): string | optional <EnterpriseAlert inline />
    - [`requestHeaders`](#requestheaders-requestheaders): HTTPHeaderModifiers | optional
      - [`Add`](#requestheaders-requestheaders): map | optional
      - [`Set`](#requestheaders-requestheaders): map | optional
      - [`Remove`](#requestheaders-requestheaders): map | optional
    - [`responseHeaders`](#responseheaders-responseheaders): HTTPHeaderModifiers | optional
      - [`Add`](#responseheaders-responseheaders): map | optional
      - [`Set`](#responseheaders-responseheaders): map | optional
      - [`Remove`](#responseheaders-responseheaders): map | optional


</Tab>
</Tabs>

## Specification

This section provides details about the fields you can configure in a `service-splitter` configuration entry.

### `apiVersion`

Kubernetes-only parameter that specifies the version of the Consul API that the configuration entry maps to Kubernetes configurations. The value must be `consul.hashicorp.com/v1alpha1`.  

### `Kind`, `kind` 

Specifies the type of configuration entry to implement. 

#### Paths
- HCL: `Kind` 
- YAML: `kind`

#### Values

- Default: none
- Required: Required
- Data type: String value that must be set to `service-splitter` in HCL or `serviceSplitter` in YAML. 

### `Name`, `name`

Specifies a name for the configuration entry. The name is metadata that you can use to reference the configuration entry when performing operations, such as reading or writing configuration entry configuration entry settings. 

#### Paths

- HCL: `Name` 
- YAML: `metadata.name 

#### Values

- Default: Name of the node 
- Required: Required
- Data type: String


### `Namespace`, `namespace` <EnterpriseAlert inline />

Specifies the [namespace](/consul/docs/enterprise/namespaces) to apply the configuration entry.

#### Paths

- HCL: `Namespace`
- YAML: `metadata.namespace`

#### Values

- Default: None
- Required: Optional
- Data type: String


### `Partition`, `partition` <EnterpriseAlert inline />
Specifies the [admin partition](consul/docs/enterprise/admin-partitions) to apply the configuration entry.

#### Paths 

- HCL: `Partition` 
- YAML: `spec.splits.partition` 

#### Values

- Default: `Default` 
- Required: Optional 
- Data type: String

### `Meta`, `meta`

Specifies key-value pairs to add to the KV store.

#### Paths

- HCL: `Meta` 
- YAML: `spec.meta` 

#### Values

- Default: none 
- Required: Optional 
- Data type: Map of one or more key-value pairs 
  - keys: String
  - values: String, integer, or float 

### `spec`

Kubernetes-only field that contains all of the configurations for service splitter pods.

#### Values

- Default: none 
- Required: Required 
- Data type: Object containing [`splits`](#splits-splits) configuration 

### `Splits`, `splits`

Defines how much traffic to send to sets of service instances during a traffic split. 

#### Paths

- HCL: `Splits`
- YAML: `spec.splits`

#### Values 

- Default: None
- Required: Required for defining service splits
- Data type: Array of objects that can contain the following fields:
  - [`Weight`](#weight-weight), `weight` in YAML: The sum of weights for a set of service instances must add up to 100. 
  - [`Service`](#service-service) , `service` in YAML: This field is required to direct split traffic   
  - [`ServiceSubset`](#servicesubset-servicesubset), `serviceSubset` in YAML
  - [`Namespace`](#namespace-namespace), `namespace` in YAML <Enterprise inline/>
  - [`Partition`](#partition-partition), `partition` in YAML <Enterprise inline/>
  - [`RequestHeaders`](#requestheaders-requestheaders), `requestHeaders` in YAML 
  - [`ResponseHeaders`](#responseheaders-responseheaders), `responseHeaders` in YAML  

### `Weight`, `weight`

Specifies the percentage of traffic sent to the set of service instances specified in the [`Service`, `service`](#service-service) field. Each weight must be a floating integer between `0` and `100`. The smallest representable value is `.01`. The sum of weights across all splits must add up to `100`.

#### Paths

- HCL: `Splits.Weight`
- YAML: `spec.splits.weight`

#### Values

- Default: `null`
- Required: Required for defining service splits
- Data type: Floating integer from `.01` to `100`

### `Service`, `service`

Specifies the name of the service to resolve.

#### Paths

- HCL: `Splits.Service`
- YAML: `spec.splits.service`

#### Values

- Default: The service matching the configuration entry [`Name`](#name-name) field.
- Required: optional
- Data type: String

### `ServiceSubset`, `serviceSubset`

Specifies a subset of the service to resolve. This field overrides the `DefaultSubset`. 

#### Paths

- HCL: `Splits.ServiceSubset`
- YAML: `spec.splits.serviceSubset`

#### Values

- Default: If empty, the `split` uses the default subset. 
- Required: optional
- Data type: String

### `Namespace`, `namespace` <EnterpriseAlert inline />

Specifies which [namespace](/consul/docs/enterprise/namespaces) to use in the FQDN when resolving the service. 

#### Paths

- HCL: `Splits.Namespace`
- YAML: `spec.splits.namespace`

#### Values

- Default: The namespace specified in the top-level configuration entry.
- Required: optional
- Data type: String

### `Partition`, `partition` <EnterpriseAlert inline />

Specifies which [admin partition](/consul/docs/enterprise/admin-partitions) to use in the FQDN when resolving the service. 

#### Paths

- HCL: `Splits.Partition`
- YAML: `spec.splits.partition`

#### Values

- Default: By default, the `service-splitter` uses the [admin partition specified in the top-level configuration entry](#partition-partition).
- Required: optional
- Data type: String


### `RequestHeaders`, `requestHeaders`

Specifies a set of HTTP-specific header modification rules that apply to requests routed to the split. You cannot configure request headers if the listener protocol is set to `tcp`. Refer to [Set HTTP Headers](#set-http-headers) for an example configuration. 

#### Paths

- HCL: `Splits.RequestHeaders`
- YAML: `spec.splits.requestHeaders` 

#### Values

- Default: None
- Required: optional
- Values: Object containing one or more fields that define header modification rules
  - `Add`, `add` in YAML: Map of one or more key-value pairs
  - `Set`, `set` in YAML: Map of one or more key-value pairs
  - `Remove`, `remove` in YAML: Map of one or more key-value pairs

The following table describes how to configure values for request headers:

| Rule | Description | Type |  Required | 
| --- 	    | ---	       | ---         | ---         | 
| `Add` <br/><nobr>`add` (Kubernetes)</nobr> | Defines a set of key-value pairs to add to the header. Use header names as the keys. Header names are not case-sensitive. If header values with the same name already exist, the value is appended and Consul applies both headers. You can [use variable placeholders](#use-variable-placeholders). | map of strings | optional |
| `Set` <br/><nobr>`set` (Kubernetes)</nobr> | Defines a set of key-value pairs to add to the request header or to replace existing header values with. Use header names as the keys. Header names are not case-sensitive. If header values with the same names already exist, Consul replaces the header values. You can [use variable placeholders](#use-variable-placeholders). | map of strings | optional |
| `Remove` <br/><nobr>`remove` (Kubernetes)</nobr> | Defines an array of headers to remove. Consul removes only headers containing exact matches. Header names are not case-sensitive. | array of strings | optional |

#### Use variable placeholders

For `Add` and `Set`, if the service is configured to use Envoy as the proxy, the value may contain variable placeholders, for example, `%DOWNSTREAM_REMOTE_ADDRESS%` to interpolate dynamic metadata into the value added.


### `ResponseHeaders` | `responseHeaders` 

Specifies a set of HTTP-specific header modification rules that apply to responses from the split. You cannot configure request headers if the listener protocol is set to `tcp`. Refer to [Set HTTP Headers](#set-http-headers) for an example configuration.

#### Paths

- HCL: `Splits.ResponseHeaders`
- YAML: `spec.splits.responseHeaders` 

#### Values

- Default: None
- Required: optional
- Values: Object containing one or more fields that define header modification rules
  - `Add`, `add` in YAML: Map of one or more string key-value pairs
  - `Set`, `set` in YAML: Map of one or more string key-value pairs
  - `Remove`, `remove` in YAML: Map of one or more string key-value pairs

The following table describes how to configure values for response headers:
  
| Rule | Description | Type |  Required | 
| --- 	    | ---	       | ---         | ---         | 
| `Add` <br/><nobr>`add` (Kubernetes)</nobr> | Defines a set of key-value pairs to add to the header. Use header names as the keys. Header names are not case-sensitive. If header values with the same name already exist, the value is appended and Consul applies both headers. You can [use variable placeholders](#use-variable-placeholders). | map of strings | optional |
| `Set` <br/><nobr>`set` (Kubernetes)</nobr> | Defines a set of key-value pairs to add to the request header or to replace existing header values with. Use header names as the keys. Header names are not case-sensitive. If header values with the same names already exist, Consul replaces the header values. You can [use variable placeholders](#use-variable-placeholders). | map of strings | optional |
| `Remove` <br/><nobr>`remove` (Kubernetes)</nobr> | Defines an array of headers to remove. Consul removes only headers containing exact matches. Header names are not case-sensitive. | array of strings | optional |

#### Use variable placeholders

For `Add` and `Set`, if the service is configured to use Envoy as the proxy, the value may contain variable placeholders, for example, `%DOWNSTREAM_REMOTE_ADDRESS%` to interpolate dynamic metadata into the value added. 

## Examples

The examples in this section demonstrate common configurations for `service-splitter` configuration entries. When every field is utilized, a `service-splitter` configuration entry takes the following form:

<Tabs>

<Tab heading="HCL" group="hcl">

```hcl
Kind      = "service-splitter"           ## string  | required
Name      = "config-entry-name"          ## string  | required
Namespace = "main"                       ## string
Partition = "partition"                  ## string 
Meta      = {                            ## map
  key     = "value"            
  }
Splits = [                               ## list    | required
  {                                      ## map     
    Weight        = 90                   ## number  | required
    Service       = "service"            ## string     
    ServiceSubset = "v1"                 ## string
    Namespace     = "target-namespace"   ## string
    Partition     = "target-partition"   ## string
    RequestHeaders {                     ## map
      Set {
        "X-Web-Version": "from-v1"
          }
     }
    ResponseHeaders {                    ## map
      Set {
        "X-Web-Version": "to-v1"
          }
    }
  },
  {
    Weight        = 10            
    Service       = "service"    
    ServiceSubset = "v2"          
    Namespace     = "target-namespace"  
    Partition     = "target-partition"  
    RequestHeaders {
      Set {
        "X-Web-Version": "from-v2"
          }
     }
    ResponseHeaders {
      Set {
        "X-Web-Version": "to-v2"
  },
]
```

</Tab>

<Tab heading="YAML" group="yaml">

```yaml
apiVersion: consul.hashicorp.com/v1alpha1         # string | required
kind: ServiceSplitter                             # string | required
metadata:                                         # object | required
  name: config-entry-name                         # string | required
  namespace: main                                 # string
spec:
  splits:                                         # list
    - weight: 90                                  # floating point | required
      service: service                            # string 
      serviceSubset: v1                           # string 
      namespace: target-namespace                 # string 
      partition: target-partition                 # string 
      requestHeaders:  
        set:
          x-web-version: from-v1                  # string 
      responseHeaders:
        set:
          x-web-version: to-v1                    # string 
    - weight: 10
      service: service
      serviceSubset: v2
      namespace: target-namespace
      partition: target-partition
      requestHeaders:
        set:
          x-web-version: from-v2
      responseHeaders:
        set:
          x-web-version: to-v2      
```

</Tab>

</Tabs>

### Two subsets of same service

Split traffic between two subsets of the same service:

<Tabs>

<Tab heading="HCL" group="hcl">

```hcl
Kind = "service-splitter"
Name = "web"
Splits = [
  {
    Weight        = 90
    ServiceSubset = "v1"
  },
  {
    Weight        = 10
    ServiceSubset = "v2"
  },
]
```

</Tab>

<Tab heading="YAML" group="yaml">

```yaml
apiVersion: consul.hashicorp.com/v1alpha1
kind: ServiceSplitter
metadata:
  name: web
spec:
  splits:
    - weight: 90
      serviceSubset: v1
    - weight: 10
      serviceSubset: v2
```

</Tab>

<Tab heading="JSON" group="json">

```json
{
  "Kind": "service-splitter",
  "Name": "web",
  "Splits": [
    {
      "Weight": 90,
      "ServiceSubset": "v1"
    },
    {
      "Weight": 10,
      "ServiceSubset": "v2"
    }
  ]
}
```

</Tab>

</Tabs>

### Two different services

Split traffic between two services:

<Tabs>

<Tab heading="HCL" group="hcl">

```hcl
Kind = "service-splitter"
Name = "web"
Splits = [
  {
    Weight  = 50
    # will default to service with same name as config entry ("web")
  },
  {
    Weight  = 50
    Service = "web-rewrite"
  },
]
```

</Tab>

<Tab heading="YAML" group="yaml">

```yaml
apiVersion: consul.hashicorp.com/v1alpha1
kind: ServiceSplitter
metadata:
  name: web
spec:
  splits:
    - weight: 50
      # will default to service with same name as config entry ("web")
    - weight: 50
      service: web-rewrite
```

</Tab>

<Tab heading="JSON" group="json">

```json
{
  "Kind": "service-splitter",
  "Name": "web",
  "Splits": [
    {
      "Weight": 50
    },
    {
      "Weight": 50,
      "Service": "web-rewrite"
    }
  ]
}
```

</Tab>

</Tabs>

### Set HTTP Headers

Split traffic between two subsets with extra headers added so clients can tell
which version:

<Tabs>

<Tab heading="HCL" group="hcl">

```hcl
Kind = "service-splitter"
Name = "web"
Splits = [
  {
    Weight        = 90
    ServiceSubset = "v1"
    ResponseHeaders {
      Set {
        "X-Web-Version": "v1"
      }
    }
  },
  {
    Weight        = 10
    ServiceSubset = "v2"
    ResponseHeaders {
      Set {
        "X-Web-Version": "v2"
      }
    }
  },
]
```

</Tab>

<Tab heading="YAML" group="yaml">

```yaml
apiVersion: consul.hashicorp.com/v1alpha1
kind: ServiceSplitter
metadata:
  name: web
spec:
  splits:
    - weight: 90
      serviceSubset: v1
      responseHeaders:
        set:
          x-web-version: v1
    - weight: 10
      serviceSubset: v2
      responseHeaders:
        set:
          x-web-version: v2
```

</Tab>

<Tab heading="JSON" group="json">

```json
{
  "Kind": "service-splitter",
  "Name": "web",
  "Splits": [
    {
      "Weight": 90,
      "ServiceSubset": "v1",
      "ResponseHeaders": {
        "Set": {
          "X-Web-Version": "v1"
        }
      }
    },
    {
      "Weight": 10,
      "ServiceSubset": "v2",
      "ResponseHeaders": {
        "Set": {
          "X-Web-Version": "v2"
        }
      }
    }
  ]
}
```

</Tab>

</Tabs>