--- 
Page_title: Service Splitter | Configuration Reference
Description: 
---

# Service Splitter Configuration Reference

This topic describes how to configure service splitter configuration entries. Configure and apply service splitters to redirect a percentage of incoming traffic requests for a specific service.

## Configuration model

The following list outlines field hierarchy, language-specific data types, and requirements in a service splitter configuration entry. Click on a property name to view details about the configuration.

<Tabs>

<Tab heading="HCL" group="hcl">

- [`Kind`](#kind): string | required
- [`Name`](#name): string | required
- [`Namespace`](#namespace): string | optional <EnterpriseAlert inline />
- [`Partition`](#partition): string | optional <EnterpriseAlert inline />
- [`Meta`](#meta): map | optional
- [`Splits`](#splits): map | required
	- [`Weight`](#splits-weight): number | required
	- [`Service`](#splits-service): string | required
	- [`ServiceSubset`](#splits-servicesubset): string | optional
  - [`Namespace`](#splits-namespace): string | optional <EnterpriseAlert inline />
  - [`Partition`](#splits-partition): string | optional <EnterpriseAlert inline />
  - [`RequestHeaders`](#requestheaders): map | optional
  - [`ResponseHeaders`](#responseheaders): map | optional

</Tab>

<Tab heading="YAML" group="yaml">

- [`apiVersion`](#apiVersion): string | required
- [`kind`](#kind): string | required
- [`metadata`](#metadata): object | required
	- [`name`](#name): string | required
	- [`namespace`](#namespace): string | optional <EnterpriseAlert inline />
- [`spec`](#spec): object | required
	- [`splits`](#splits): array | required
		- [`weight`](#splits-weight): float32 | required
		- [`service`](#splits-service): string | required
	  - [`serviceSubset`](#splits-servicesubset): string | optional
    - [`namespace`](#splits-namespace): string | optional <EnterpriseAlert inline />
    - [`partition`](#splits-partition): string | optional <EnterpriseAlert inline />
    - [`requestHeaders`](#splits-requestheaders): HTTPHeaderModifiers | optional
    - [`responseHeaders`](#responseheaders): HTTPHeaderModifiers | optional

</Tab>
</Tabs>

## Specification

This section provides details about the fields you can configure in a `service-splitter` configuration entry.

### Kind (kind)

Specifies the type of configuration entry to implement. 

#### Paths
- HCL: `Kind` 
- YAML: `kind`

| Format | Path |
| --- | --- |
| HCL | `Kind' |
| YAML | `kind |

#### Values
 Takes a string value that must be set to `service-splitter` in HCL or `serviceSplitter` in YAML. This field is required and does not have a default value.

### Name

| | |
|--- | --- |
| **Description** | Specifies a name for the configuration entry. The name is metadata that you can use to reference the configuration entry when performing operations, such as reading or writing configuration entry configuration entry settings. |
| <nobr>**HCL path**</nobr> | `Name` |
| **YAML path** | `metadata.name` |
| **Default** | Defaults to the node name |
| **Required** | Required |
| **Values** | Takes a string value. |
| | |

### Namespace <EnterpriseAlert inline />

Specifies the [namespace](/consul/docs/enterprise/namespaces) to apply the configuration entry.

- HCL path: `Namespace`
- YAML path: `metadata.namespace`
- Default: None
- Values: Takes a string value


### Partition <EnterpriseAlert inline />
Specifies the [admin partition](consul/docs/enterprise/admin-partitions) to apply the configuration entry.

| | | 
|--- | --- |
| <nobr>**HCL path**</nobr> | `Partition` |
| **YAML path** | `spec.splits.partition` |
| **Default** | `Default` |
| **Required** | Optional |
| **Values** | Takes a string value. |
| | |


### Meta

Specifies key/value pairs to add to the K/V store.

||| 
|--- | --- |
| **HCL path** | `Meta` |
| <nobr>**YAML path**</nobr> | `spec.meta` |
| **Default** | none |
| **Required** | Optional |
| **Values** | This field contains an object of or more key-value pairs. They key takes a string data type and values can take strings, integers, or floats. |
| | |


<a name="splits"/>

### Splits | splits

Defines how much traffic to send to sets of service instances during a traffic split. 

#### Paths
Declare the parameter according to your configuration format:

- HCL: `Splits`
- YAML: `spec.splits`

#### Values 
This paramter contains an array of objects containing or more of the following fields:

- [`Weight` | `weight`](): The sum of weights for a set of service instances must add up to 100. 
- [`Service` | `service`](): This field is required to direct split traffic   
- [`ServiceSubset` | `serviceSubset`]()
- [`Namespace` | `namespace`]() <Enterprise inline/>
- [`Partition` | `partition`]() <Enterprise inline/>
- [`RequestHeaders` | `requestHeaders`](#requestheaders) 
- [`ResponseHeaders` | `responseHeaders`](#responseheaders)  

### Splits.weight

Specifies what percentage of the traffic is sent to the set of service instances specified in the [`splits.Service`](#splits-service) field.

Each weight must be a floating integer between `0` and `100`. The smallest representable value is `.01`. The sum of weights across all splits must add up to `100`.

- JSON data type: `float32`
- Default: `null`
- Required: optional

### Splits.service

Specifies the name of the service to resolve. If undefined, this value defaults to the service with the same name as the configuration entry.

- JSON data type: `array`
- Default: ""
- Required: optional

### Splits.serviceSubset

Specifies a subset of the service to resolve. This field overrides the `DefaultSubset`. If empty, the `split` uses the default subset.

- JSON data type: `string`
- Default: ""
- Required: optional

### Splits.namespace <EnterpriseAlert inline />

Specifies which [namespace](/consul/docs/enterprise/namespaces) to use for resolving the service. By default, the `service-splitter` uses the [namespace specified in the top-level configuration entry](#namespace).

- JSON data type: `string`
- Default: `null`
- Required: optional

### Splits.partition <EnterpriseAlert inline />

Specifies which [admin partition](/consul/docs/enterprise/admin-partitions) to use for resolving the service. By default, the `service-splitter` uses the [admin partition specified in the top-level configuration entry](#partition).

- JSON data type: `string`
- Default: `null`
- Required: optional

<a name="requestheaders"/>

### RequestHeaders | requestHeaders

Specifies a set of HTTP-specific header modification rules that apply to requests routed to the split. You cannot configure request headers if the listener protocol is set to `tcp`.

#### Paths

- HCL: `RequestHeaders`
- YAML: `spec.splits.requestHeaders` 


#### Values
This parameter contains an object that defines one or more rules for modifying request headers. Each rule contains one or more key-value pairs. The following table describes how to configure values for request headers. There are no default values:

| Rule | Description | Type |  Required | 
| --- 	    | ---	       | ---         | ---         | 
| `Add` <br/><nobr>`add` (Kubernetes)</nobr> | Defines a set of key-value pairs to add to the header. Use header names as the keys. Header names are not case-sensitive. If header values with the same name already exist, the value is appended and Consul applies both headers. You can [use variable placeholders](#use-variable-placeholders). | map of strings | optional |
| `Set` <br/><nobr>`set` (Kubernetes)</nobr> | Defines a set of key-value pairs to add to the request header or to replace existing header values with. Use header names as the keys. Header names are not case-sensitive. If header values with the same names already exist, Consul replaces the header values. You can [use variable placeholders](#use-variable-placeholders). | map of strings | optional |
| `Remove` <br/><nobr>`remove` (Kubernetes)</nobr> | Defines an array of headers to remove. Consul removes only headers containing exact matches. Header names are not case-sensitive. | array of strings | optional |

#### Use variable placeholders

For `Add` and `Set`, if the service is configured to use Envoy as the proxy, the value may contain variable placeholders, for example, `%DOWNSTREAM_REMOTE_ADDRESS%` to interpolate dynamic metadata into the value added.
 
<!--
- JSON data type: `string`
- Default: `null`
- Required: optional
-->

<a name="responseheaders"/> 

### ResponseHeaders | responseHeaders 

Specifies a set of HTTP-specific header modification rules that apply to responses from the split. You cannot configure request headers if the listener protocol is set to `tcp`.

- **HCL path**: `Splits.ResponseHeaders`

- **YAML path**: `spec.splits.responseHeaders`

- **Default**: None

- **Values**: 
 The following table describes how to configure values for response headers:
  
 | Rule | Description | Type |  Required | 
 | --- 	    | ---	       | ---         | ---         | 
 | `Add` <br/><nobr>`add` (Kubernetes)</nobr> | Defines a set of key-value pairs to add to the header. Use header names as the keys. Header names are not case-sensitive. If header values with the same name already exist, the value is appended and Consul applies both headers. You can [use variable placeholders](#use-variable-placeholders). | map of strings | optional |
 | `Set` <br/><nobr>`set` (Kubernetes)</nobr> | Defines a set of key-value pairs to add to the request header or to replace existing header values with. Use header names as the keys. Header names are not case-sensitive. If header values with the same names already exist, Consul replaces the header values. You can [use variable placeholders](#use-variable-placeholders). | map of strings | optional |
 | `Remove` <br/><nobr>`remove` (Kubernetes)</nobr> | Defines an array of headers to remove. Consul removes only headers containing exact matches. Header names are not case-sensitive. | array of strings | optional |

 #### Use variable placeholders

 For `Add` and `Set`, if the service is configured to use Envoy as the proxy, the value may contain variable placeholders, for example, `%DOWNSTREAM_REMOTE_ADDRESS%` to interpolate dynamic metadata into the value added.


<!-- JSON data type: `string`
- Default: `null`
- Required: optional

</Tab>

<Tab heading="YAML" group="yaml">

### apiVersion

Specifies the version of the Consul API for integrating with Kubernetes. The value must be `consul.hashicorp.com/v1alpha1`. The `apiVersion` field is not supported for non-Kubernetes deployments.

- JSON data type: `string`
- Default: ""
- Required: required

### kind

Specifies the type of configuration entry to implement. Must be set to `serviceSplitter`.

- JSON data type: `string`
- Default: ""
- Required: required

### metadata

Kubernetes-only object that contains the service name, namespace, and admin partition that the configuration entry applies to.

- JSON data type: `object`
- Default: ""
- Required: required

### metadata.name

Specifies a name for the configuration entry. The name is metadata that you can use to reference the configuration entry when performing operations, such as reading or writing configuration entry configuration entry settings.

- JSON data type: `string`
- Default: ""
- Required: required

### metadata.namespace <EnterpriseAlert inline />

Specifies the [namespace](/consul/docs/enterprise/namespaces) to apply the configuration entry.

- JSON data type: `string`
- Default: `null`
- Required: optional

### spec

Kubernetes-only object that contains the details about the `service-defaults` configuration entry. The `apiVersion`, `kind`, and `metadata` fields are siblings of the `spec` field. All other configurations are children.

- JSON data type: `object`
- Default: `null`
- Required: required

### spec.splits

Defines how much traffic to send to sets of service instances during a traffic split. The sum of weights for a set of service instances must add up to 100. Either [`Splits.service`]#splits-servicesubset) or `[Splits.serviceSubset`](#splits-servicesubset) must be defined to direct split traffic.

- JSON data type: `array`
- Default: `null`
- Required: optional

### spec.splits.weight

Specifies what percentage of the traffic is sent to the set of service instances specified in the [`splits.Service`](#splits-service) field.

Each weight must be a floating integer between `0` and `100`. The smallest representable value is `.01`. The sum of weights across all splits must add up to `100`.

- JSON data type: `float32`
- Default: `null`
- Required: optional

### spec.splits.service

Specifies the name of the service to resolve. If undefined, this value defaults to the service with the same name as the configuration entry.

- JSON data type: `array`
- Default: ""
- Required: optional

### spec.splits.serviceSubset

Specifies a subset of the service to resolve. This field overrides the `DefaultSubset`. If empty, the `split` uses the default subset.

- JSON data type: `string`
- Default: ""
- Required: optional

### spec.splits.namespace <EnterpriseAlert inline />

Specifies which [namespace](/consul/docs/enterprise/namespaces) to use for resolving the service. By default, the `service-splitter` uses the [namespace specified in the top-level configuration entry](#namespace).

- JSON data type: `string`
- Default: `null`
- Required: optional

### spec.splits.partition <EnterpriseAlert inline />

Specifies which [admin partition](/consul/docs/enterprise/admin-partitions) to use for resolving the service. By default, the `service-splitter` uses the [admin partition specified in the top-level configuration entry](#partition).

- JSON data type: `string`
- Default: `null`
- Required: optional

### spec.splits.requestHeaders

A set of HTTP-specific header modification rules that apply to requests routed to this split. This field cannot be used with a tcp listener.

- JSON data type: `string`
- Default: `null`
- Required: optional

### spec.splits.responseHeaders

A set of HTTP-specific header modification rules that apply to responses from this split. This field cannot be used with a tcp listener.

- JSON data type: `string`
- Default: `null`
- Required: optional

</Tab>
</Tabs>
-->

## Examples

The examples in this section demonstrate common configurations for `service-splitter` configuration entries. When every field is utilized, a `service-splitter` configuration entry takes the following form:

<Tabs>

<Tab heading="HCL" group="hcl">

```hcl
Kind      = "service-splitter"           ## string  | required
Name      = "config-entry-name"          ## string  | required
Namespace = "main"                       ## string
Partition = "partition"                  ## string 
Meta      = {                            ## map
  key     = "value"            
  }
Splits = [                               ## list    | required
  {                                      ## map     
    Weight        = 90                   ## number  | required
    Service       = "service"            ## string     
    ServiceSubset = "v1"                 ## string
    Namespace     = "target-namespace"   ## string
    Partition     = "target-partition"   ## string
    RequestHeaders {                     ## map
      Set {
        "X-Web-Version": "from-v1"
          }
     }
    ResponseHeaders {                    ## map
      Set {
        "X-Web-Version": "to-v1"
          }
    }
  },
  {
    Weight        = 10            
    Service       = "service"    
    ServiceSubset = "v2"          
    Namespace     = "target-namespace"  
    Partition     = "target-partition"  
    RequestHeaders {
      Set {
        "X-Web-Version": "from-v2"
          }
     }
    ResponseHeaders {
      Set {
        "X-Web-Version": "to-v2"
  },
]
```

</Tab>

<Tab heading="YAML" group="yaml">

```yaml
apiVersion: consul.hashicorp.com/v1alpha1         # string | required
kind: ServiceSplitter                             # string | required
metadata:                                         # object | required
  name: config-entry-name                         # string | required
  namespace: main                                 # string
spec:
  splits:                                         # list
    - weight: 90                                  # floating point | required
      service: service                            # string 
      serviceSubset: v1                           # string 
      namespace: target-namespace                 # string 
      partition: target-partition                 # string 
      requestHeaders:  
        set:
          x-web-version: from-v1                  # string 
      responseHeaders:
        set:
          x-web-version: to-v1                    # string 
    - weight: 10
      service: service
      serviceSubset: v2
      namespace: target-namespace
      partition: target-partition
      requestHeaders:
        set:
          x-web-version: from-v2
      responseHeaders:
        set:
          x-web-version: to-v2      
```

</Tab>

</Tabs>

### Two subsets of same service

Split traffic between two subsets of the same service:

<Tabs>

<Tab heading="HCL" group="hcl">

```hcl
Kind = "service-splitter"
Name = "web"
Splits = [
  {
    Weight        = 90
    ServiceSubset = "v1"
  },
  {
    Weight        = 10
    ServiceSubset = "v2"
  },
]
```

</Tab>

<Tab heading="YAML" group="yaml">

```yaml
apiVersion: consul.hashicorp.com/v1alpha1
kind: ServiceSplitter
metadata:
  name: web
spec:
  splits:
    - weight: 90
      serviceSubset: v1
    - weight: 10
      serviceSubset: v2
```

</Tab>

<Tab heading="JSON" group="json">

```json
{
  "Kind": "service-splitter",
  "Name": "web",
  "Splits": [
    {
      "Weight": 90,
      "ServiceSubset": "v1"
    },
    {
      "Weight": 10,
      "ServiceSubset": "v2"
    }
  ]
}
```

</Tab>

</Tabs>

### Two different services

Split traffic between two services:

<Tabs>

<Tab heading="HCL" group="hcl">

```hcl
Kind = "service-splitter"
Name = "web"
Splits = [
  {
    Weight  = 50
    # will default to service with same name as config entry ("web")
  },
  {
    Weight  = 50
    Service = "web-rewrite"
  },
]
```

</Tab>

<Tab heading="YAML" group="yaml">

```yaml
apiVersion: consul.hashicorp.com/v1alpha1
kind: ServiceSplitter
metadata:
  name: web
spec:
  splits:
    - weight: 50
      # will default to service with same name as config entry ("web")
    - weight: 50
      service: web-rewrite
```

</Tab>

<Tab heading="JSON" group="json">

```json
{
  "Kind": "service-splitter",
  "Name": "web",
  "Splits": [
    {
      "Weight": 50
    },
    {
      "Weight": 50,
      "Service": "web-rewrite"
    }
  ]
}
```

</Tab>

</Tabs>

### Set HTTP Headers

Split traffic between two subsets with extra headers added so clients can tell
which version:

<Tabs>

<Tab heading="HCL" group="hcl">

```hcl
Kind = "service-splitter"
Name = "web"
Splits = [
  {
    Weight        = 90
    ServiceSubset = "v1"
    ResponseHeaders {
      Set {
        "X-Web-Version": "v1"
      }
    }
  },
  {
    Weight        = 10
    ServiceSubset = "v2"
    ResponseHeaders {
      Set {
        "X-Web-Version": "v2"
      }
    }
  },
]
```

</Tab>

<Tab heading="YAML" group="yaml">

```yaml
apiVersion: consul.hashicorp.com/v1alpha1
kind: ServiceSplitter
metadata:
  name: web
spec:
  splits:
    - weight: 90
      serviceSubset: v1
      responseHeaders:
        set:
          x-web-version: v1
    - weight: 10
      serviceSubset: v2
      responseHeaders:
        set:
          x-web-version: v2
```

</Tab>

<Tab heading="JSON" group="json">

```json
{
  "Kind": "service-splitter",
  "Name": "web",
  "Splits": [
    {
      "Weight": 90,
      "ServiceSubset": "v1",
      "ResponseHeaders": {
        "Set": {
          "X-Web-Version": "v1"
        }
      }
    },
    {
      "Weight": 10,
      "ServiceSubset": "v2",
      "ResponseHeaders": {
        "Set": {
          "X-Web-Version": "v2"
        }
      }
    }
  ]
}
```

</Tab>

</Tabs>