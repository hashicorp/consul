---
page_title: Service Defaults Configuration Reference
description: Use the service-defaults configuration entry to set default configurations for services, such as upstreams, protocols, and namespaces. Learn how to configure service-defaults.
---

# Service Defaults Configuration Reference
This topic describes how to configure service defaults configuration entries. Configure and apply service defaults to specify common configurations, such as upstreams and gateways, for all services in your cluster. Refer to [Define service defaults]() for usage information.

## Configuration model

The following outline shows how to format the service splitter configuration entry. Click on a property name to view details about the configuration.

<Tabs>
<Tab heading="HCL" group="hcl">

- [`Kind`](#kind): string | no default
- [`Name`](#name): string | no default
- [`Namespace`](#namespace): string | no default | <EnterpriseAlert inline /> 
- [`Partition`](#partition): string | no default | <EnterpriseAlert inline /> 
- [`Meta`](#meta): object | no default
- [`Protocol`](#protocol): string | default: `tcp`
- [`BalanceInboundConnections`](#balanceinboundconnection): string | no default
- [`Mode`](#mode): string | no default
- [`UpstreamConfig`](#upstreamconfig): object | no default
  - [`Overrides`](#upstreamconfig-overrides): array of objects | no default
    - [`Name`](#upstreamconfig-overrides-name): string | no default
    - [`Namespace`](#upstreamconfig-overrides-namespace): string | no default
    - [`Protocol`](#upstreamconfig-overrides-protocol): string | no default
    - [`ConnectTimeoutMs`](#upstreamconfig-overrides-connecttimeoutms): int | default: `5000`
    - [`MeshGateway`](#upstreamconfig-overrides-meshgateway): object | no default
      - [`mode`](#upstreamconfig-overrides-meshgateway): string | no default
    - [`BalanceOutboundConnections`](#overrides-balanceoutboundconnections): string | no default 
    - [`Limits`](#upstreamconfig-overrides-limits): list of objects | optional 
      - [`MaxConnections`](#upstreamconfig-overrides-limits): integer | `0`
      - [`MaxPendingRequests`](#upstreamconfig-overrides-limits): integer | `0`
      - [`MaxConcurrentRequests`](#upstreamconfig-overrides-limits): integer | `0`
    - [`PassiveHealthCheck`](#upstreamconfig-overrides-passivehealthchecks): list of objects | optional
      - [`Interval`](#upstreamconfig-overrides-passivehealthchecks): string | `0s`
      - [`MaxFailures`](#upstreamconfig-overrides-passivehealthchecks): integer | `0`
      - [`EnforcingConsecutive5xx`](#upstreamconfig-overrides-passivehealthchecks): integer | `100`
  - [`Defaults`](#upstreamconfig-defaults): array of objects | no default
    - [`Protocol`](#upstreamconfig-defaults-protocol): string | no default
    - [`ConnectTimeoutMs`](#upstreamconfig-defaults-connecttimeoutms): int | default: `5000`
    - [`MeshGateway`](#upstreamconfig-defaults-meshgateway): object | no default
      - [`mode`](#upstreamconfig-defaults-meshgateway): string | no default
    - [`BalanceOutboundConnections`](#upstreamconfig-defaults-balanceoutboundconnections): string | no default 
    - [`Limits`](#upstreamconfig-defaults-limits): list of objects | optional 
      - [`MaxConnections`](#upstreamconfig-defaults-limits): integer | `0`
      - [`MaxPendingRequests`](#upstreamconfig-defaults-limits): integer | `0`
      - [`MaxConcurrentRequests`](#upstreamconfig-defaults-limits): integer | `0`
    - [`PassiveHealthCheck`](#upstreamconfig-defaults-passivehealthchecks): list of objects | optional
      - [`Interval`](#upstreamconfig-defaults-passivehealthchecks): string | `0s`
      - [`MaxFailures`](#upstreamconfig-defaults-passivehealthchecks): integer | `0`
      - [`EnforcingConsecutive5xx`](#upstreamconfig-defaults-passivehealthchecks): integer | 
- [`TransparentProxy`](#transparentproxy): list of objects | no default
  - [`OutboundListenerPort`](#transparentproxy-outboundlistenerport): integer | `15001`
  - [`DialedDirectly`](#transparentproxy-dialeddirectly): boolean | `false`
- [`Destination`](#destination): list of objects | no default
  - [`Addresses`](#destination-addresses): array of strings | no default
  - [`Port`](#destination-port): integer | `0`
- [`MaxInboundConnections`](#maxinboundconnections): integer | `0`
- [`LocalConnectTimeoutMs`](#localconnecttimeoutms): integer | `0`
- [`LocalRequestTiimeoutMs`](#localrequesttimeoutms): integer | `0`
- [`MeshGateway`](#meshgateway): object | no default
  - [`Mode`](#meshgateway): string | no default
- [`ExternalSNI`](#externalsni): string | no default
- [`Expose`](#expose): object | no default
  - [`Checks`](#expose-checks): boolean | `false`
  - [`Paths`](#expose-paths): array of objects | no default
    - [`Path`](#expose-paths): string | no default
    - [`LocalPathPort`](#expose-paths): integer | `0`
    - [`ListenerPort`](#expose-paths): integer | `0`
    - [`Protocol`](#expose-paths): string | `http`





</Tab>
<Tab heading="Kubernetes YAML" group="yaml">

- [`apiVersion`](#apiversion): string | must be set to `consul.hashicorp.com/v1alpha1`
- [`kind`](#kind): string | no default
- [`metadata`](#metadata): object | no default
  - [`name`](#name): string | no default
  - [`namespace`](#namespace): string | no default | <EnterpriseAlert inline /> 
  - [`partition`](#partition): string | no default | <EnterpriseAlert inline /> 
- [`spec`](#spec): object | no default
  - [`protocol`](#protocol): string | default: `tcp`
  - [`balanceInboundConnections`](#balanceinboundconnection): string | no default
  - [`mode`](#mode): string | no default
  - [`upstreamConfig`](#upstreamconfig): object | no default
    - [`overrides`](#upstreamconfig-overrides): array of objects | no default
      - [`name`](#upstreamconfig-overrides-name): string | no default
      - [`namespace`](#upstreamconfig-overrides-namespace): string | no default
      - [`protocol`](#upstreamconfig-overrides-protocol): string | no default
      - [`connectTimeoutMs`](#upstreamconfig-overrides-connecttimeoutms): int | default: `5000`
      - [`meshGateway`](#upstreamconfig-overrides-meshgateway): object | no default
        - [`mode`](#upstreamconfig-overrides-meshgateway): string | no default
      - [`balanceOutboundConnections`](#overrides-balanceoutboundconnections): string | no default 
      - [`limits`](#upstreamconfig-overrides-limits): list of objects | optional 
        - [`maxConnections`](#upstreamconfig-overrides-limits): integer | `0`
        - [`maxPendingRequests`](#upstreamconfig-overrides-limits): integer | `0`
        - [`maxConcurrentRequests`](#upstreamconfig-overrides-limits): integer | `0`
      - [`passiveHealthCheck`](#upstreamconfig-overrides-passivehealthchecks): list of objects | optional
        - [`interval`](#upstreamconfig-overrides-passivehealthchecks): string | `0s`
        - [`maxFailures`](#upstreamconfig-overrides-passivehealthchecks): integer | `0`
        - [`mnforcingConsecutive5xx`](#upstreamconfig-overrides-passivehealthchecks): integer | `100`
    - [`defaults`](#upstreamconfig-defaults): array of objects | no default
      - [`protocol`](#upstreamconfig-defaults-protocol): string | no default
      - [`connectTimeoutMs`](#upstreamconfig-defaults-connecttimeoutms): int | default: `5000`
      - [`meshGateway`](#upstreamconfig-defaults-meshgateway): object | no default
        - [`mode`](#upstreamconfig-defaults-meshgateway): string | no default
      - [`balanceOutboundConnections`](#upstreamconfig-defaults-balanceoutboundconnections): string | no default 
      - [`limits`](#upstreamconfig-defaults-limits): list of objects | optional 
        - [`maxConnections`](#upstreamconfig-defaults-limits): integer | `0`
        - [`maxPendingRequests`](#upstreamconfig-defaults-limits): integer | `0`
        - [`maxConcurrentRequests`](#upstreamconfig-defaults-limits): integer | `0`
      - [`passiveHealthCheck`](#upstreamconfig-defaults-passivehealthchecks): list of objects | optional
        - [`interval`](#upstreamconfig-defaults-passivehealthchecks): string | `0s`
        - [`maxFailures`](#upstreamconfig-defaults-passivehealthchecks): integer | `0`
        - [`enforcingConsecutive5xx`](#upstreamconfig-defaults-passivehealthchecks): integer | 
  - [`transparentProxy`](#transparentproxy): list of objects | no default
    - [`outboundListenerPort`](#transparentproxy-outboundlistenerport): integer | `15001`
    - [`dialedDirectly`](#transparentproxy-dialeddirectly): boolean | `false`
  - [`destination`](#destination): list of objects | no default
    - [`addresses`](#destination-addresses): array of strings | no default
    - [`port`](#destination-port): integer | `0`
  - [`maxInboundConnections`](#maxinboundconnections): integer | `0`
  - [`localConnectTimeoutMs`](#localconnecttimeoutms): integer | `0`
  - [`localRequestTiimeoutMs`](#localrequesttimeoutms): integer | `0`
  - [`meshGateway`](#meshgateway): object | no default
    - [`mode`](#meshgateway): string | no default
  - [`externalSNI`](#externalsni): string | no default
  - [`expose`](#expose): object | no default
    - [`checks`](#expose-checks): boolean | `false`
    - [`paths`](#expose-paths): array of objects | no default
      - [`path`](#expose-paths): string | no default
      - [`localPathPort`](#expose-paths): integer | `0`
      - [`listenerPort`](#expose-paths): integer | `0`
      - [`protocol`](#expose-paths): string | `http`

</Tab>
</Tabs>

## Specification
This section provides details about the fields you can configure in the `service-defaults` configuration entry. 

### apiVersion 
Specifies the version of the Consul API for integrating with Kubernetes. The value must be `consul.hashicorp.com/v1alpha1`. The `apiVersion` field is not supported for non-Kubernetes deployments. 

Data type: string
Default: none
Required: Required for Kubernetes; not applicable for other runtimes 

### Kind
Specifies the configuration entry type.
Data type: string 
Default: none
Required: required

#### Virtual machines
The value must be `service-defaults`. 

#### Kubernetes
Use lowercase `kind` in YAML. The value must be `ServiceDefaults`.


### Name 
Specifies the name of the service you are setting the defaults for. 

Data type: string
Default: none
Required: required

#### Kubernetes
Specify the service name in the `metadata.name` field in YAML for Kubernetes. 

### Namespace <Enterprise/>
Specifies the Consul namespace that the configuration entry applies to. 

Data type: string
Default: `default`
Required: optional

#### Kubernetes
Specify the namespace in the `metadata.namespace` field in YAML for Kubernetes. Refer to [Consul Enterprise](/consul/docs/k8s/crds#consul-enterprise) for information about how Consul namespaces map to Kubernetes Namespaces. Open source Consul distributions (Consul OSS) ignore the `namespace` configuration.   

### Partition <Enterprise/>
Specifies the name of the name of the Consul admin partition that the configuration entry applies to.  Refer to [Admin Partitions](/consul/docs/enterprise/admin-partitions) for additional information.

Data type: string
Default: `default`
Required: optional
#### Kubernetes
Specify the admin partition in the `metadata.partition` field in YAML for Kubernetes. Consul OSS distributions ignore the `partition` configuration.   
### Meta
Specifies a set of custom key-value pairs. The field supports string values and stores them in the [Consul KV](/consul/docs/dynamic-app-config/kv). This field is not supported on Kubernetes.

Data type: Object containing string key-value pairs
Default: none
Required: optional

### metadata

Kubernetes-only object that contains the service name, namespace, and admin partition that the configuration entry applies to. Refer to the following sections for configuration details:

[`Name`](#name)
[`Namespace`](#namespace)
[`Partition`](#partition)

### spec
Kubernetes-only object that contains the details about the `service-defaults` configuration entry. The `apiVersion`, `kind`, and `metadata` fields are siblings of the `spec` field. All other configurations are children.   

### Protocol
Specifies the default protocol for the service. This is used by Connect proxies for things like observability features and to unlock usage of the [\service-splitter`](/docs/connect/config-entries/service-splitter) and `service-router` config entries for a service. It also unlocks the ability to define L7 intentions via `service-intentions`.

The following value are supported: 
`tcp` (default)
`http` 
`http2`
`grpc` 

You can set the global protocol for proxies in the [`proxy-defaults`](/consul/docs/connect/config-entries/proxy-defaults#default-protocol) configuration entry, but the protocol specified in the `service-defaults` configuration entry overrides the `proxy-defaults` configuration.    

Data type: string
Default: `tcp`
Required: optional

Refer to [Set the default protocol](#set-the-default-protocol) for an example configuration.
#### Kubernetes
Configure the protocol in the `spec.protocol` field in YAML for Kubernetes. 
### BalanceInboundConnections
Specifies the strategy for allocating inbound connections to the service across Envoy proxy threads. The only supported value is `exact_balance`. By default, no connections are balanced. Refer to the [Envoy documentation](https://cloudnative.to/envoy/api-v3/config/listener/v3/listener.proto.html#config-listener-v3-listener-connectionbalanceconfig) for details. 

Data type: string
Default: none
Required: optional

#### Kubernetes
Configure the inbound connections strategy in the `spec.balanceInboundConnections` field in YAML for Kubernetes. 

### Mode
Specifies a mode for how the service directs inbound and outbound traffic. 

Data type: string
Default: none
Required: optional

You can specified the following values:

`direct`: The proxy's listeners must be dialed directly by the local application and other proxies. 
`transparent`: The service captures inbound and outbound traffic and redirects it through the proxy. The mode does not enable the traffic redirection. It instructs Consul to configure Envoy as if traffic is already being redirected. 

#### Kubernetes
Configure the mode in the `spec.mode` field in YAML for Kubernetes. 
### UpstreamConfig
Specifies an object that controls default upstream connection settings and custom overrides for individual upstream services. If your network contains federated datacenters, individual upstream configurations apply to all pairs of source and upstream destination services in the network. 

Data type: object
Default: none
Required: optional

Refer to the following fields for details: 
[`UpstreamConfig.Overrides`](#upstreamconfig-overrides)
[`UpstreamConfig.Defaults`](#upstreamconfig-defaults)
#### Kubernetes
Configure upstreams in the `spec.upstreamConfig` field in YAML for Kubernetes.

### UpstreamConfig.Overrides
Specifies options that override the [default upstream configurations](#upstreamconfig-defaults) for individual upstreams. 

Data type: array
Default: none
Required: optional
#### Kubernetes
Configure upstream overrides in the `spec.upstreamConfig.overrides` field in YAML for Kubernetes.
### UpstreamConfig.Overrides.Name
Specifies the name of the upstream service that the configuration applies to. We recommend that you do not use the `*` wildcard to avoid applying the configuration to unintended upstreams.

Data type: string
Default: none
Required: optional
#### Kubernetes
Configure an upstream name override in the `spec.upstreamConfig.overrides.name` field in YAML for Kubernetes.

### UpstreamConfig.Overrides.Namespace <Enterprise/>
Specifies the namespace containing the upstream service that the configuration applies to. We recommend that you do not use the `*` wildcard to avoid applying the configuration to unintended upstreams.

Data type: string
Default: none
Required: optional
#### Kubernetes
Configure an upstream namespace override in the `spec.upstreamConfig.overrides.name` field in YAML for Kubernetes.

### UpstreamConfig.Overrides.Protocol
Specifies the protocol to use for requests to the upstream listener. We recommend configuring the protocol in the main [`Protocol`](#protocol) field of the configuration entry so that you can leverage [L7 features](/consul/docs/connect/l7-traffic). Setting the protocol in an upstream configuration limits L7 management functionality.

Data type: string
Default: none
Required: optional
#### Kubernetes
Configure an upstream protocol override in the `spec.upstreamConfig.overrides.protocol` field in YAML for Kubernetes.

### UpstreamConfig.Overrides.ConnectionTimeoutMs
Specifies how long in milliseconds that the service should attempt to establish an upstream connection before timing out. 

For non-Kubernetes environments, we recommend configuring the upstream timeout in the [`connection_timeout`](/consul/docs/connect/config-entries/service-resolver#connecttimeout) field of the `service-resolver` configuration entry for the upstream destination service. Doing so enables you to leverage [L7 features](/consul/docs/connect/l7-traffic). Configuring the timeout in the `service-defaults` upstream configuration limits L7 management functionality.

Data type: integer
Default: `5000`
Required: optional
#### Kubernetes
Configure an upstream connection timeout in the `spec.upstreamConfig.overrides.connectionTimeoutMs` field in YAML for Kubernetes. We recommend configuring the upstream timeout in the [`connectTimeout`](/consul/docs/connect/config-entries/service-resolver#connecttimeout) field of the `ServiceResolver` CRD for the upstream destination service. Doing so enables you to leverage [L7 features](/consul/docs/connect/l7-traffic). Configuring the timeout in the `service-defaults` upstream configuration limits L7 management functionality.
### UpstreamConfig.Overrides.MeshGateway
Object that contains the default mesh gateway `mode` field for the upstream. Refer to [Connect Proxy Configuration](/consul/docs/connect/gateways/mesh-gateway#connect-proxy-configuration) in the mesh gateway documentation for additional information. 

You can specify the following string values for the `mode` field:

`none`: The service does not make outbound connections through a mesh gateway. Instead, the service makes outbound connections directly to the destination services.
`local`: The service mesh proxy makes an outbound connection to a gateway running in the same datacenter. 
`remote`: The service mesh proxy makes an outbound connection to a gateway running in the destination datacenter.  
#### Kubernetes
Configure the mesh gateway connection mode in the `spec.upstreamConfig.overrides.meshGateway.mode` field in YAML for Kubernetes.

### UpstreamConfig.Overrides.BalanceOutboundConnections

Sets the strategy for allocating outbound connections from the upstream across Envoy proxy threads. The only supported value is `exact_balance`. By default, no connections are balanced. Refer to the [Envoy documentation](https://cloudnative.to/envoy/api-v3/config/listener/v3/listener.proto.html#config-listener-v3-listener-connectionbalanceconfig) for details. 

Data type: string
Default: none
Required: optional

#### Kubernetes
Configure the outbound connections strategy in the `spec.upstreamConfig.overrides.balanceInboundConnections` field in YAML for Kubernetes. 

### UpstreamConfig.Overrides.Limits
Object that specifies a set of limits to apply to when connecting to individual upstream services. The following table describes limits you can configure:

Limit
Description
Data type
Default
`MaxConnections`
`maxConnections` (Kubernetes)
Specifies the maximum number of connections a service instance can establish against the upstream. Define this limit for HTTP/1.1 traffic.
Integer
`0`
`MaxPendingRequests`
`maxPendingRequests` (Kubernetes)
Specifies the maximum number of requests that are queued while waiting for a connection to establish. An L7 protocol must be defined in the [`protocol`]() field for this limit to take effect.
Integer
`0`
`MaxConcurrentRequests`
`maxConcurrentRequests` (Kubernetes
Specifies the maximum number of concurrent requests. Define this limit for HTTP/2 traffic. An L7 protocol must be defined in the [`protocol`]() field for this limit to take effect.
Integer
`0`


#### Kubernetes
Configure the outbound connections strategy in the `spec.upstreamConfig.overrides.limits` field in YAML for Kubernetes. 

### UpstreamConfig.Overrides.PassiveHealthCheck
Object that specifies a set of rules that enable Consul to remove hosts from the upstream cluster that are unreachable or that return errors. The following table describes passive health check parameters you can configure:

Parameter
Description
Data type
Default
`Interval`
`interval` (Kubernetes)
Specifies time between checks. 
string
`0s`
`MaxFailures`
`maxFailures` (Kubernetes)
Specifies the number of consecutive failures allowed per check interval. If exceeded, Consul removes the host from the load balancer.
Integer
`0`
`EnforcingConsecutive5xx `
`enforcingConsecutive5xx ` (Kubernetes)
Specifies a percentage that indicates how many times out of 100 that Consul ejects the host when it detects an outlier status. The outlier status is determined by consecutive errors in the 500-599 response range.
Integer
`100`


#### Kubernetes
Configure the outbound connections strategy in the `spec.upstreamConfig.overrides.passiveHealthCheck` field in YAML for Kubernetes. 

### UpstreamConfig.Defaults
Specifies options that set the default upstream configurations. For information about overriding the default configurations for in for individual upstreams, refer to [`UpstreamConfig.Overrides`]](#upstreamconfig-overrides). 

Data type: array
Default: none
Required: optional

#### Kubernetes
Configure upstream defaults in the `spec.upstreamConfig.defaults` field in YAML for Kubernetes.

### UpstreamConfig.Defaults.Protocol
Specifies default protocol for upstream listeners. We recommend configuring the protocol in the main [`Protocol`](#protocol) field of the configuration entry so that you can leverage [L7 features](/consul/docs/connect/l7-traffic). Setting the protocol in an upstream configuration limits L7 management functionality.

Data type: string
Default: none
Required: optional
#### Kubernetes
Configure an upstream protocol override in the `spec.upstreamConfig.defaults.protocol` field in YAML for Kubernetes.

### UpstreamConfig.Defaults.ConnectionTimeoutMs
Specifies how long in milliseconds that all services should continue attempting to establish an upstream connection before timing out. 

For non-Kubernetes environments, we recommend configuring the upstream timeout in the [`connection_timeout`](/consul/docs/connect/config-entries/service-resolver#connecttimeout) field of the `service-resolver` configuration entry for the upstream destination service. Doing so enables you to leverage [L7 features](/consul/docs/connect/l7-traffic). Configuring the timeout in the `service-defaults` upstream configuration limits L7 management functionality.

Data type: integer
Default: `5000`
Required: optional
#### Kubernetes
Configure upstream connection timeouts in the `spec.upstreamConfig.default.connectionTimeoutMs` field in YAML for Kubernetes. We recommend configuring the upstream timeout in the [`connectTimeout`](/consul/docs/connect/config-entries/service-resolver#connecttimeout) field of the `ServiceResolver` CRD for upstream destination services. Doing so enables you to leverage [L7 features](/consul/docs/connect/l7-traffic). Configuring the timeout in the `service-defaults` upstream configuration limits L7 management functionality.

### UpstreamConfig.Defaults.MeshGateway
Specifies the default mesh gateway `mode` field for all upstreams. Refer to [Connect Proxy Configuration](/consul/docs/connect/gateways/mesh-gateway#connect-proxy-configuration) in the mesh gateway documentation for additional information. 

You can specify the following string values for the `mode` field:

`none`: The service does not make outbound connections through a mesh gateway. Instead, the service makes outbound connections directly to the destination services.
`local`: The service mesh proxy makes an outbound connection to a gateway running in the same datacenter. 
`remote`: The service mesh proxy makes an outbound connection to a gateway running in the destination datacenter.  
#### Kubernetes
Configure the mesh gateway connection mode in the `spec.upstreamConfig.defaults.meshGateway.mode` field in YAML for Kubernetes.

### UpstreamConfig.Defaults.BalanceOutboundConnections

Sets the strategy for allocating outbound connections from upstreams across Envoy proxy threads. The only supported value is `exact_balance`. By default, no connections are balanced. Refer to the [Envoy documentation](https://cloudnative.to/envoy/api-v3/config/listener/v3/listener.proto.html#config-listener-v3-listener-connectionbalanceconfig) for details. 

Data type: string
Default: none
Required: optional

#### Kubernetes
Configure the outbound connections strategy in the `spec.upstreamConfig.defaults.balanceInboundConnections` field in YAML for Kubernetes. 

### UpstreamConfig.Defaults.Limits
Object that specifies a set of limits to apply to when connecting upstream services. The following table describes limits you can configure:

Limit
Description
Data type
Default
`MaxConnections`
`maxConnections` (Kubernetes)
Specifies the maximum number of connections a service instance can establish against the upstream. Define this limit for HTTP/1.1 traffic.
Integer
`0`
`MaxPendingRequests`
`maxPendingRequests` (Kubernetes)
Specifies the maximum number of requests that are queued while waiting for a connection to establish. An L7 protocol must be defined in the [`protocol`]() field for this limit to take effect.
Integer
`0`
`MaxConcurrentRequests`
`maxConcurrentRequests` (Kubernetes
Specifies the maximum number of concurrent requests. Define this limit for HTTP/2 traffic. An L7 protocol must be defined in the [`protocol`]() field for this limit to take effect.
Integer
`0`


#### Kubernetes
Configure the outbound connections strategy in the `spec.upstreamConfig.defaults.limits` field in YAML for Kubernetes. 

### UpstreamConfig.Defaults.PassiveHealthCheck
Object that specifies a set of rules that enable Consul to remove hosts from the upstream cluster that are unreachable or that return errors. The following table describes the health check parameters you can configure:

Parameter
Description
Data type
Default
`Interval`
`interval` (Kubernetes)
Specifies time between checks. 
string
`0s`
`MaxFailures`
`maxFailures` (Kubernetes)
Specifies the number of consecutive failures allowed per check interval. If exceeded, Consul removes the host from the load balancer.
Integer
`0`
`EnforcingConsecutive5xx `
`enforcingConsecutive5xx ` (Kubernetes)
Specifies a percentage that indicates how many times out of 100 that Consul ejects the host when it detects an outlier status. The outlier status is determined by consecutive errors in the 500-599 response range.
Integer
`100`


#### Kubernetes
Configure the outbound connections strategy in the `spec.upstreamConfig.defaults.passiveHealthCheck` field in YAML for Kubernetes. 

### TransparentProxy
Controls configurations specific to proxies in transparent mode. You can configure the following parameters in the `TransparentProxy` block:

Parameter
Description
Data type
Default
`OutboundListenerPort`
`outboundListenerPort` (Kubernetes)
Specifies the port that the proxy listens on for outbound traffic. This must be the same port number where outbound application traffic is redirected. 
integer
`15001`
`DialedDirectly`
`dialedDirectly` (Kubernetes)
Enables transparent proxies to dial the proxy instance's IP address directly when set to `true`. Transparent proxies commonly dial upstreams at the `"virtual"` tagged address, which load balances across instances. Dialing individual instances can be helpful for stateful services, such as a database cluster with a leader.
boolean
`false`

Refer to [Transparent Proxy](/consul/docs/connect/transparent-proxy) for additional information. 

#### Kubernetes
Configure transparent proxy settings in the `spec.transparentProxy` field in YAML for Kubernetes. 
### Destination

Configures the destination for service traffic through terminating gateways. You can configure the following parameters in the `Destination` block:

Parameter
Description
Data type
Default
`Address`
`address` (Kubernetes)
Specifies a list of addresses for the destination. You can configure a list of hostnames and IP addresses. Wildcards are  not supported. 
array
none
`Port`
`port` (Kubernetes)
Specifies the port number for the destination 
integer
`0`


Refer to [Terminating Gateway](/consul/docs/connect/terminating-gateway) for additional information. 

#### Kubernetes
Configure destination settings for terminating gateways in the `spec.destination` field in YAML for Kubernetes. 

### MaxInboundConnections
Specifies the maximum number of concurrent inbound connections to each service instance.

Data type: integer
Default: `0`
Required: optional
#### Kubernetes
Configure maximum number of concurrent inbound connections in the `spec.maxInboundConnections` field in YAML for Kubernetes.
### LocalConnectTimeoutMs
Specifies the number of milliseconds allowed for establishing connections to the local application instance before timing out.

Data type: integer
Default: `5000`
Required: optional
#### Kubernetes
Configure the local timeout in the `spec.localConnectTimeoutMs` field in YAML for Kubernetes.

### LocalRequestTimeoutMs 
Specifies the timeout for HTTP requests to the local application instance. Applies to HTTP-based protocols only. If not specified, inherits the Envoy default for route timeouts.

Data type: string
Default: `15s` (default inherited from Envoy)
Required: optional
#### Kubernetes
Configure the local HTTP timeout in the `spec.localRequestTimeoutMs` field in YAML for Kubernetes.

### MeshGateway 
Specifies the default mesh gateway `mode` field for the service. Refer to [Connect Proxy Configuration](/consul/docs/connect/gateways/mesh-gateway#connect-proxy-configuration) in the mesh gateway documentation for additional information. 

You can specify the following string values for the `mode` field:

`none`: The service does not make outbound connections through a mesh gateway. Instead, the service makes outbound connections directly to the destination services.
`local`: The service mesh proxy makes an outbound connection to a gateway running in the same datacenter. 
`remote`: The service mesh proxy makes an outbound connection to a gateway running in the destination datacenter.  
#### Kubernetes
Configure the mesh gateway connection mode in the `spec.meshGateway.mode` field in YAML for Kubernetes.

### MeshGateway 
Specifies the default mesh gateway `mode` field for the service. Refer to [Connect Proxy Configuration](/consul/docs/connect/gateways/mesh-gateway#connect-proxy-configuration) in the mesh gateway documentation for additional information. 

You can specify the following string values for the `mode` field:

`none`: The service does not make outbound connections through a mesh gateway. Instead, the service makes outbound connections directly to the destination services.
`local`: The service mesh proxy makes an outbound connection to a gateway running in the same datacenter. 
`remote`: The service mesh proxy makes an outbound connection to a gateway running in the destination datacenter.  
#### Kubernetes
Configure the mesh gateway connection mode in the `spec.meshGateway.mode` field in YAML for Kubernetes.

### ExternalSNI 
Specifies the TLS server name indication (SNI) when federating with an external system. 

Data type: string
Default: none
Required: optional 
#### Kubernetes
Configure the TLS SNI in the `spec.externalSNI` field in YAML for Kubernetes.

### Expose 
Specifies default configurations for exposing HTTP paths through Envoy. Exposing paths through Envoy enables services to listen on localhost only. Applications that are not Consul service mesh-enabled can still contact an HTTP endpoint. Refer to [Expose Paths Configuration Reference](/consul/docs/connect/registration/service-registration#expose-paths-configuration-reference) for additional information and example configurations.

Data type: string
Default: none
Required: optional 
#### Kubernetes
Define configurations for exposing paths through Envoy in the `spec.expose` field in YAML for Kubernetes.

### Expose.Checks
Exposes all HTTP and gRPC checks registered with the agent if set to `true`. Envoy exposes listeners for the checks and only accepts connections originating from localhost or Consul's [`advertise_addr`](/consul/docs/agent/config/config-files#advertise_addr). The ports for the listeners are dynamically allocated from the agent's [`expose_min_port`](/docs/agent/config/config-files#expose_min_port) and [`expose_max_port`](/docs/agent/config/config-files#expose_max_port) configurations. 

We recommend enabling the `Checks` configuration when a Consul client cannot reach registered services over localhost, such as when Consul agents run in their own pods in Kubernetes.

Data type: boolean
Default: `false`
Required: optional

#### Kubernetes
Enable HTTP and gRPC checks to be exposed through Envoy in the `spec.expose.checks` field in YAML for Kubernetes. 

### Expose.Paths
Specifies an array of objects that define paths to expose through Envoy when `Expose.Checks` is set to `true`. You can configure the following parameters for each object:


Parameter
Description
Data type
Default
`Path`
`path` (Kubernetes)
Specifies the HTTP path to expose. You must prepend the path with a forward slash (`/`).
string
none
`LocalPathPort`
`localPathPort` (Kubernetes)
Specifies the port where the local service listens for connections to the path.
integer
`0`
`ListenerPort`
`ListenerPort` (Kubernetes)
Specifies the port where the proxy listens for connections. The port must be available. If the port is unavailable, Envoy does not expose a listener for the path and the proxy registration still succeeds.
integer
`0`
`Protocol`
`protocol` (Kubernetes)
Specifies the protocol of the listener. You can configure one of the following values:
`http` 
`http2`: Use with gRPC traffic


string
`http`



#### Kubernetes
Define paths to expose through Envoy in the `spec.expose.paths` field in YAML for Kubernetes. 

## Example configurations
The following examples describe common `service-defaults` configurations.
### Upstream configuration
In the following example, the default connection limits and mesh gateway mode across all upstreams of "counting" and also override the mesh gateway mode used when dialing the "dashboard" service in the "frontend" namespace.

<CodeTabs tabs={[ "HCL", "Kubernetes YAML", "JSON" ]}>

```hcl
Kind = "service-defaults"
Name = "counting"
Namespace = "product"

UpstreamConfig = {
  Defaults = {
    MeshGateway = {
      Mode = "local"
    }
    Limits = {
      MaxConnections = 512
      MaxPendingRequests = 512
      MaxConcurrentRequests = 512
    }
  }

  Overrides = [
    {
      Name = "dashboard"
      Namespace = "frontend"
      MeshGateway = {
        Mode = "remote"
      }
    }
  ]
}
```

```yaml
apiVersion: consul.hashicorp.com/v1alpha1
kind: ServiceDefaults
metadata:
  name: counting
  namespace: product
spec:
  upstreamConfig:
    defaults:
      meshGateway:
        mode: local
      limits:
        maxConnections: 512
        maxPendingRequests: 512
        maxConcurrentRequests: 512
    overrides:
      - name: dashboard
        namespace: frontend
        meshGateway:
          mode: remote
```

```json
{
  "Kind": "service-defaults",
  "Name": "counting",
  "Namespace": "product",
  "UpstreamConfig": {
    "Defaults": {
      "MeshGateway": {
        "Mode": "local"
      },
      "Limits": {
        "MaxConnections": 512,
        "MaxPendingRequests": 512,
        "MaxConcurrentRequests": 512
      }
    },
    "Overrides": [
      {
        "Name": "dashboard",
        "Namespace": "frontend",
        "MeshGateway": {
          "Mode": "remote"
        }
      }
    ]
  }
}
```
</CodeTabs>

### Terminating gateway destination

Create a default destination that will be assigned to a terminating gateway. A destination represents a location outside the Consul cluster. They can be dialed directly when transparent proxy mode is enabled.

<CodeTabs tabs={[ "HCL", "Kubernetes YAML", "JSON" ]}>

```hcl
Kind = "service-defaults"
Name = "test-destination"
Protocol = "tcp"
Destination {
  Addresses = ["test.com","test.org"]
  Port = 443
}
```

```yaml
apiVersion: consul.hashicorp.com/v1alpha1
kind: ServiceDefaults
metadata:
  name: test-destination
spec:
  destination:
    addresses:
      - "test.com"
      - "test.org"
    port: 443
```

```json
{
  "Kind": "service-defaults",
  "Name": "test-destination",
  "Protocol": "http",
  "Destination": {
    "Addresses": ["test.com","test.org"],
    "Port": 443
  }
}
```
</CodeTabs>

### Set the default protocol

Set the default protocol for a service in the default namespace to HTTP:

<CodeTabs tabs={[ "HCL", "Kubernetes YAML", "JSON" ]}>

```hcl
Kind      = "service-defaults"
Name      = "web"
Namespace = "default"
Protocol  = "http"
```

```yaml
apiVersion: consul.hashicorp.com/v1alpha1
kind: ServiceDefaults
metadata:
  name: web
spec:
  protocol: http
```

```json
{
  "Kind": "service-defaults",
  "Name": "web",
  "Namespace": "default",
  "Protocol": "http"
}
```

</CodeTabs>

### Define default and override upstream configurations
In the following example, the default connection limits and mesh gateway mode across all upstreams of "counting", and also override the mesh gateway mode used when dialing the "dashboard" service.

<CodeTabs tabs={[ "HCL", "Kubernetes YAML", "JSON" ]}>

```hcl
Kind = "service-defaults"
Name = "counting"

UpstreamConfig = {
  Defaults = {
    MeshGateway = {
      Mode = "local"
    }
    Limits = {
      MaxConnections = 512
      MaxPendingRequests = 512
      MaxConcurrentRequests = 512
    }
  }

  Overrides = [
    {
      Name = "dashboard"
      MeshGateway = {
        Mode = "remote"
      }
    }
  ]
}
```

```yaml
apiVersion: consul.hashicorp.com/v1alpha1
kind: ServiceDefaults
metadata:
  name: counting
spec:
  upstreamConfig:
    defaults:
      meshGateway:
        mode: local
      limits:
        maxConnections: 512
        maxPendingRequests: 512
        maxConcurrentRequests: 512
    overrides:
      - name: dashboard
        meshGateway:
          mode: remote
```

```json
{
  "Kind": "service-defaults",
  "Name": "counting",
  "UpstreamConfig": {
    "Defaults": {
      "MeshGateway": {
        "Mode": "local"
      },
      "Limits": {
        "MaxConnections": 512,
        "MaxPendingRequests": 512,
        "MaxConcurrentRequests": 512
      }
    },
    "Overrides": [
      {
        "Name": "dashboard",
        "MeshGateway": {
          "Mode": "remote"
        }
      }
    ]
  }
}
```
</CodeTabs>
