---
layout: docs
page_title: Revert to BoltDB
description: >-
  Learn how to safely configure and test the experimental WAL backend in your Consul deployment.
---

# Revert storage backend to BoltDB from WAL 

This topic describes revert your Consul storage backend from the experimental WAL LogStorage backend to the default BoltDB.

The overall process for reverting to BoltDB consists of the following steps. You will need to repeat these steps for all Consul servers. Notice this is very similar to enabling WAL.

1. Select target server.
1. Stop target server gracefully.
1. Remove data directory from target server.
1. Update target server's configuration.
1. Start target server.

## Select target server

If you are using Consul OSS or Consul Enterprise without non-voting servers, select one of the follower servers. As noted in [Risks](/consul/docs/agent/wal-logstore/enable#risks), Consul Enterprise users with non-voting servers should select a non-voting server at first.

Retrieve the current state of the servers by running the following:

```shell-session
$ consul operator raft list-peers
```

## Stop target server gracefully

Stop the target server gracefully. For example, if you are using `systemcmd`, 
run the following command:

```shell-session
$ systemctl stop consul
```

If you have any configuration management automation that might interfere with this process (for example, Chef or Puppet), you must disable them until you have completely enabled WAL 
as a storage backend.


## Remove data directory from target server

Temporarily moving the data directory to a different location is less destructive than deleting it. We recommend doing this in case you unsuccessfully enable WAL. However, once you restart the server, you should not use the old data directory (`/data-dir/raft.bak`) for recovery, and will eventually need to delete it.

Move the data directory. Replace `/data-dir` the value you have specified in your configuration file.

```shell-session
$ mv /data-dir/raft /data-dir/raft.bak
```

When switching backend, you must always remove the _whole raft directory_ not just the `raft.db` file or `wal` directory since the log must always be consistent with the snapshots to avoid undefined behavior or data loss.

## Update target server's configuration

Modify the `backend` in the target server's configuration file:

```hcl
raft_logstore {
  backend = "boltdb"
  verification {
    enabled = true
    interval = "60s"
  }
}
```

## Start target server

Start the target server. For example, if you are using `systemcmd`, run the following command:

```shell-session
$ systemctl start consul
```

Watch for the server to become a healthy voter again.

```shell-session
$ consul operator raft list-peers
```

### Clean up old data directories

If necessary, cleanup any `raft.bak` directories. Replace `/data-dir` the value you have specified in your configuration file.

```shell-session
$ rm /data-dir/raft.bak
```