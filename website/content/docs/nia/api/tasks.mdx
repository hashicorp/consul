---
layout: docs
page_title: Consul-Terraform-Sync Tasks API
description: >-
  Consul-Terraform-Sync Tasks API
---
# Tasks

The `/tasks` endpoints modify the tasks that Consul-Terraform-Sync is responsible for running.

## Update Task

This endpoint allows patch updates to specifically supported fields for existing tasks. Currently only supports updating a task's [`enabled` value](/docs/nia/configuration#enabled-4).

| Method | Path                | Produces           |
| ------ | ------------------- | ------------------ |
| `PATCH`  | `/tasks/:task_name` | `application/json` |

#### Request Parameters

| Name | Type	 | Required | Description  |
| -----| ----- | -------- | ------------ |
|`run` | string | false   | Values can only be `"inspect"` and `"now"`.<br/><ul><li>`"inspect"`: Does not update the task but returns information on if/how resources would be changed for the proposed task update.</li><li> `"now"`: Updates the task accordingly and immediately runs the task, rather than allowing the task to run at the natural daemon cadence</li></ul>

#### Request Body

| Name | Type	 | Required | Description  |
| -----| ----- | -------- | ------------ |
|`enabled` | boolean | true | Whether the task is enabled to run and manage resources.|

#### Response Statuses

| Status | Reason           |
| ------ | ------------------ |
| 200  | Successfully updated the task |
| 404  | Task with the given name not found |

#### Response Fields

| Name	| Type	 | Description        |
| --------- | ------ | ------------------ |
|`inspect` | object |  Information on how resources would be changed given a proposed task update, similar to [inspect-mode](/docs/nia/cli/cli-overview#inspect-mode). This is only returned when passed the `run=inspect` request parameter.
|`inspect.changes_present` | boolean | Whether or not changes were detected for running the proposed task update.
|`inspect.plan` | string | The Terraform plan generated for the proposed task update. Note: a non-empty string does not necessarily indicate changes were detected.


#### Example: Disable a task

Request:
```shell-session
$ curl --header "Content-Type: application/json" \
  --request PATCH \
  --data '{"enabled":false}' \
  localhost:8558/v1/tasks/task_a
```

Response:
```json
{}
```

#### Example: Inspect enabling a task

Request:
```shell-session
$ curl --header "Content-Type: application/json" \
  --request PATCH \
  --data '{"enabled":true}' \
  localhost:8558/v1/tasks/task_a?run=inspect
```

Response if no changes present:
```json
{
  "inspect": {
    "changes_present": false,
    "plan": "No changes. Infrastructure is up-to-date. <truncated>"
  }
}
```

Response if changes present:
```json
{
  "inspect": {
    "changes_present": true,
    "plan": "<terraform plan truncated> Plan: 3 to add, 0 to change, 0 to destroy."
  }
}
```

## Delete Task

This endpoint allows for deletion of existing tasks. It does not allow deletion of a task that is currently running.

| Method | Path                | Produces           |
| ------ | ------------------- | ------------------ |
| `DELETE`  | `/tasks/:task_name` | `application/json` |

#### Response Statuses

| Status | Reason           |
| ------ | ------------------ |
| 200  | Successfully deleted the task |
| 404  | Task with the given name not found |
| 409  | Task is currently running |

#### Response Fields
| Name	| Type	 | Description        |
| --------- | ------ | ------------------ |
|`request_id` | string | The ID of the request. Used for auditing and debugging purposes.

#### Sample Request
```shell-session
$ curl --request DELETE \
  localhost:8558/v1/tasks/task_a
```

#### Sample Response
```json
{
  "request_id": "9b23eea7-a435-2797-c71e-10c15766cd73"
}
```
