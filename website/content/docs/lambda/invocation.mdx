---
layout: docs
page_title: Invocation - AWS Lambda
description: >-
  Options for invoking AWS Lambdas from the Consul Service Mesh.
---

# Lambda Invocation

Consul supports invoking Lambdas in two ways:
- Through terminating gateways.
- Directly from connect proxies.

When invoking Lambdas through connect proxies, intentions and transparent proxy
are unsupported. Therefore, we recomend invoking Lambdas through terminating
gateways.

## Invocation Types

### Recommended: Terminating Gateway

Invoking Lambdas through terminating gateways supports cross-datacenter communication, transparent
proxies, intentions, and all other Consul service mesh features. It requires
the terminating gateway to have [the appropriate IAM permissions](/docs/lambda/requirements#allow-envoy-to-invoke-the-lambda)
to invoke the Lambda.

**Architecture**:

<ImageConfig width={700}>

![Terminating Gateway to Lambda](/img/terminating_gateway_to_lambda.svg)

</ImageConfig>

1. Make an HTTP request to the local Connect proxy.
2. The Connect proxy forwards the request on to the terminating gateway.
3. The terminating gateway invokes the Lambda.

### Connect Proxy

This invocation type directly invokes Lambdas from a service's Connect proxy.
It has the following limitations:
- Intentions are unsupported - Consul enforces intentions on receiving end of
  connections by validating client certificates. Lambda doesn't support
  validating client certificates, so we are unable to support intentions.
- Transparent proxies are unsupported - Since Lambda services are not
  registered to a proxy, so transparent proxying to not be supported.

This approach is secure because Lambdas cannot be invoked without the correct AWS
IAM permissions and invocations use Amazonâ€™s TLS. The Envoy sidecar proxy
will need to have the correct AWS IAM credentials defined to invoke the Lambda.
These credentials can be defined in environment variables, EC2 metadata or ECS
task metadata.

**Architecture**:

<ImageConfig width={400}>

![Connect Proxy to Lambda](/img/connect_proxy_to_lambda.svg)

</ImageConfig>

1. Make an HTTP request to the local Connect proxy.
2. The Connect proxy invokes the Lambda.

## Invoking the Lambda

### Assumptions
* A service named `api` is registered and running on Consul service mesh.
* A Lambda service named `authentication` [is registered into Consul](/docs/lambda/registration/overview).

### Use the Lambda Service as an Upstream

Update the `api` service's proxy registration configuration to use the
`authentication` service as an upstream:

```hcl
upstreams {
  local_bind_port = 2345
  destination_name = "authentication"
}
```

Store the configuration with `consul services register api-sidecar-proxy.hcl`.

### Invoke the Lambda Service

Call `curl localhost:2345` from `api` to invoke the `authentication` service.
