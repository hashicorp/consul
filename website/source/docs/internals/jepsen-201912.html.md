---
layout: "docs"
page_title: "Jepsen Testing"
sidebar_current: "docs-internals-jepsen"
description: |-
  FIXME
---

# Jepsen Testing

Outline
- Introduction
  - Why do we revisit Hashicorp Consul tests? What features are built on raft now?
    - Testing the foundations of Consul: What features are built on top of it? (Key value store, locks, txns?)
    - 
  - Who, what, when, where, why.
  - We're going to talk about updates to the jepsen test suite we've done.
  - Originally worked on 5.5 years ago.
  - We'll explain what jepsen testing is, how the Consul team has tested Consul in jepsen before, how the tests work, what's new, how Consul has fared given the update, and future work to do.
- What is Jepsen testing
  - About http://jepsen.io/#about-jepsen
  - Resources, for example [analyses](http://jepsen.io/analyses), [talks](http://jepsen.io/talks), and resources, like the [consistency graph and explanations](http://jepsen.io/consistency)
- What's Consul's jepsen testing history
  - 5.5 years ago X and Y set out to write their own Jepsen tests -- very rare for the time. Their results turned out pretty well! Adding consistency levels (todo link to docs mentioned in the blog post)
    - [Test and results](https://aphyr.com/posts/316-call-me-maybe-etcd-and-consul) 
  - Previous version of the docs (maybe move them to a new page, link to it in the new release post)
- How does Consul's Register test work?
  - TODO Need to draw a bunch of diagrams of a register test in Consul branding
    - Network diagram 5 consul nodes, partitions. (you can key off of some stuff from the mongodb analysis here)
    - Diagram of how an independent register test works.
    - Diagram of what a nonlinearizable result looks like (can use an example out of linear.png?)
- What did we change
  - Updated to latest jepsen version (TODO double check version 0.16/17 ?)
  - Fixed register test CAS (TODO link to commit and line)
  - Applied jepsen.independent to raise the thoughput 10x (TODO link to commit and line)
  - Added workloads so we can run subsets of multiple tests types (useful for CI) (TODO link to commit and line)
- How did we do?
  - So far so good!
    - todo(kit) Include images/embeds of individual test results, S3 downloads for sets of test results.
    - todo(kit) Need to run more samples for the release
    - todo(kit) Double check that we're configured for strong consistency per the docs above. Check behavior without strong consistency enabled
- What's on the roadmap? It's a side project so there is no roadmap yet, but some stuff that would be cool to add is:
  - More workloads
  - More configuration for Consul
  - More nemeses types and compositions
    - pause, kill, membership, clocks, etc.
    - https://github.com/jepsen-io/etcd/blob/master/src/jepsen/etcd/nemesis.clj
  - Test more versions
  - CI integration
  - New checkers?
  - Testing other HashiCorp products' use of Raft, e.g. Nomad and Vault's. Linearizable systems are not guaranteed to compose, so it's important to test both the library itself (Raft) and a system's usage of Raft

Research:
List of all articles referring to jepsen in Consul web: https://github.com/hashicorp/consul/search?q=jepsen&unscoped_q=jepsen
